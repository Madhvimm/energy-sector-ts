<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.548">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Powering Change - Financial Time Series Models (ARCH/GARCH)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Powering Change</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./introduction.html"> 
<span class="menu-text">Intro</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data-sources.html"> 
<span class="menu-text">DataSources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data-visualization.html"> 
<span class="menu-text">DataVisualization</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./exploratory-data-analysis.html"> 
<span class="menu-text">EDA</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./univariate-ts-models.html"> 
<span class="menu-text">Univariate TS Models</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./multivariate-ts-models.html"> 
<span class="menu-text">Multivariate TS Models</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./financial-ts-models.html" aria-current="page"> 
<span class="menu-text">Financial TS Models</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./deep-learning-ts.html"> 
<span class="menu-text">Deep Learning for TS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./conclusions.qmd"> 
<span class="menu-text">Conclusions</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">1. Introduction</a>
  <ul class="collapse">
  <li><a href="#exxon-mobil-corporation-and-its-market-influence" id="toc-exxon-mobil-corporation-and-its-market-influence" class="nav-link" data-scroll-target="#exxon-mobil-corporation-and-its-market-influence">Exxon Mobil Corporation and its Market Influence</a></li>
  <li><a href="#chevron-corporation-and-its-economic-role" id="toc-chevron-corporation-and-its-economic-role" class="nav-link" data-scroll-target="#chevron-corporation-and-its-economic-role">Chevron Corporation and its Economic Role</a></li>
  <li><a href="#analytical-approach-using-arch-and-garch-models" id="toc-analytical-approach-using-arch-and-garch-models" class="nav-link" data-scroll-target="#analytical-approach-using-arch-and-garch-models">Analytical Approach Using ARCH and GARCH Models</a></li>
  </ul></li>
  <li><a href="#plot-the-data" id="toc-plot-the-data" class="nav-link" data-scroll-target="#plot-the-data">2. Plot the Data</a></li>
  <li><a href="#fitting-the-model" id="toc-fitting-the-model" class="nav-link" data-scroll-target="#fitting-the-model">3. Fitting the Model</a></li>
  <li><a href="#acfpacf-plots" id="toc-acfpacf-plots" class="nav-link" data-scroll-target="#acfpacf-plots">4. ACF/PACF Plots</a>
  <ul class="collapse">
  <li><a href="#returns" id="toc-returns" class="nav-link" data-scroll-target="#returns">4.1 Returns</a></li>
  <li><a href="#absolute-returns" id="toc-absolute-returns" class="nav-link" data-scroll-target="#absolute-returns">4.2 Absolute Returns</a></li>
  <li><a href="#squared-returns" id="toc-squared-returns" class="nav-link" data-scroll-target="#squared-returns">4.3 Squared Returns</a></li>
  </ul></li>
  <li><a href="#arch-test" id="toc-arch-test" class="nav-link" data-scroll-target="#arch-test">5. ARCH Test</a></li>
  <li><a href="#fitting-arima-model" id="toc-fitting-arima-model" class="nav-link" data-scroll-target="#fitting-arima-model">6. Fitting ARIMA model</a></li>
  <li><a href="#analyising-the-residuals" id="toc-analyising-the-residuals" class="nav-link" data-scroll-target="#analyising-the-residuals">7. Analyising the Residuals</a></li>
  <li><a href="#method-1-garch-model-on-arima-residuals" id="toc-method-1-garch-model-on-arima-residuals" class="nav-link" data-scroll-target="#method-1-garch-model-on-arima-residuals">8. Method 1: GARCH Model on ARIMA Residuals</a></li>
  <li><a href="#method-2-garch-model" id="toc-method-2-garch-model" class="nav-link" data-scroll-target="#method-2-garch-model">9. Method 2: GARCH Model</a></li>
  <li><a href="#model-diagnostics" id="toc-model-diagnostics" class="nav-link" data-scroll-target="#model-diagnostics">10. Model Diagnostics</a></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation">11. Cross-Validation</a></li>
  <li><a href="#final-model" id="toc-final-model" class="nav-link" data-scroll-target="#final-model">12. Final Model</a></li>
  <li><a href="#forecasting-with-the-final-model" id="toc-forecasting-with-the-final-model" class="nav-link" data-scroll-target="#forecasting-with-the-final-model">13. Forecasting with the Final Model</a></li>
  <li><a href="#volatility-plot" id="toc-volatility-plot" class="nav-link" data-scroll-target="#volatility-plot">14. Volatility Plot</a></li>
  <li><a href="#model-equations" id="toc-model-equations" class="nav-link" data-scroll-target="#model-equations">15. Model Equations</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Financial Time Series Models (ARCH/GARCH)</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>1. Introduction</h1>
<p>In this section of our project, we will analyze financial time series data related to key players in the energy market, specifically Exxon Mobil Corporation (XOM) and Chevron Corporation (CVX). These companies, pivotal in the global energy landscape, not only reflect the economic pulses of the oil industry but also provide insights into how shifts in energy policies and market dynamics influence significant economic indicators.</p>
<section id="exxon-mobil-corporation-and-its-market-influence" class="level3">
<h3 class="anchored" data-anchor-id="exxon-mobil-corporation-and-its-market-influence">Exxon Mobil Corporation and its Market Influence</h3>
<p>Exxon Mobil, a titan in the oil industry, has been at the forefront of energy production and innovation. The company’s activities span across the extraction, refining, and distribution of energy products, positioning it as a critical barometer for assessing the economic health and trends within the energy sector. By examining the financial time series of Exxon Mobil’s stock prices, we aim to capture the volatility and market sentiment that underpin the broader economic implications of shifts in oil prices and energy policies.</p>
</section>
<section id="chevron-corporation-and-its-economic-role" class="level3">
<h3 class="anchored" data-anchor-id="chevron-corporation-and-its-economic-role">Chevron Corporation and its Economic Role</h3>
<p>Similarly, Chevron, as a major competitor and another influential player in the oil market, offers a complementary perspective to the economic analysis of the energy sector. Chevron’s extensive operations in energy production and its strategic responses to global energy demands make its financial performance a valuable indicator of the sector’s economic stability and growth. The analysis of Chevron’s stock price volatility will help us understand how energy market fluctuations and transitions toward renewable resources impact major energy corporations.</p>
</section>
<section id="analytical-approach-using-arch-and-garch-models" class="level3">
<h3 class="anchored" data-anchor-id="analytical-approach-using-arch-and-garch-models">Analytical Approach Using ARCH and GARCH Models</h3>
<p>To conduct the time series analysis of financial data from Exxon Mobil and Chevron, we will utilize ARCH (Autoregressive Conditional Heteroskedasticity) and GARCH (Generalized Autoregressive Conditional Heteroskedasticity) models. These models are particularly effective for financial market data as they adeptly handle the inherent volatility typical of stock return data. By examining the volatility patterns in the stock prices of XOM and CVX, we aim to glean insights into how market dynamics, driven by both traditional and renewable energy sources, are shaping the economic narratives of these leading corporations.</p>
<p>In this detailed exploration, our objective is to uncover how historical and present economic conditions, policy shifts, and global energy crises influence the financial trajectories of key energy players. These insights will not only deepen our understanding of the energy sector’s impact on global economics but also aid in formulating strategies for a sustainable energy future.</p>
</section>
</section>
<section id="plot-the-data" class="level1">
<h1>2. Plot the Data</h1>
<p>To visually analyze the stock price trends of Exxon Mobil and Chevron Corporation, we will employ the quantmod package to fetch and plot the data.</p>
<p>Graphical representations provide intuitive insights into the financial performance over time, highlighting trends, volatilities, and anomalies that might not be immediately apparent from raw data</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Exxon Mobil</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Chevron Corporation</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the stock prices</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chartSeries</span>(Exxon_stockprice, <span class="at">theme =</span> <span class="fu">chartTheme</span>(<span class="st">"white"</span>),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">bar.type =</span> <span class="st">"hlc"</span>,  </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">up.col =</span> <span class="st">"green"</span>,  </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">dn.col =</span> <span class="st">"red"</span>) </span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The chart shows the stock price movement for Exxon Mobil Corporation from January 1990 to April 2024. The data, represented through a high-low-close (HLC) bar chart, shows trajectory of prices over more than three decades. A general uptrend can be observed in the late ’90s, followed by increased volatility and several peaks and dips that suggest fluctuating market conditions through the 2000s and 2010s. The trading volume, in the histogram below the main price chart, offers a narrative on market sentiment, with spikes in volume associated with changes in the industry.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the stock prices</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chartSeries</span>(Chevron_stockprice, <span class="at">theme =</span> <span class="fu">chartTheme</span>(<span class="st">"white"</span>),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">bar.type =</span> <span class="st">"hlc"</span>,  </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">up.col =</span> <span class="st">"green"</span>,  </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">dn.col =</span> <span class="st">"red"</span>) </span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The chart displays Chevron Corporation’s stock prices from 1990 to April 2024, capturing significant ups and downs that reflect key changes in the energy industry and wider economic trends. The green and red bars indicates when prices went up or down each day. After a clear rise in prices until the late ’90s, the stock experiences noticeable volatility, swinging up and down.</p>
<p>The histogram below the chart, which tracks trading volume, aligns with notable shifts in stock prices, suggesting times when investors were particularly active. This visualization lays the groundwork for a detailed examination of price volatility using ARCH/GARCH models, offering a visual summary of the market forces that have influenced Chevron’s stock over the years.</p>
</div>
</div>
</div>
</section>
<section id="fitting-the-model" class="level1">
<h1>3. Fitting the Model</h1>
<p>Now, we will move forward to fit an ARCH/GARCH model to the stock price data. The first step in this process is to prepare the time series by calculating the stock price returns, which are typically used in financial time series modeling because they are more likely to exhibit stationary properties—a key requirement for ARCH/GARCH models.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Exxon Mobil</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Chevron Corporation</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a time series object</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>Exxon_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Exxon_stockprice<span class="sc">$</span>XOM.Adjusted, <span class="at">start=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"1990-01-01"</span>)), <span class="at">frequency =</span> <span class="fl">365.25</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate log returns</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>returns_exxon <span class="ot">&lt;-</span> <span class="fu">log</span>(Exxon_ts)<span class="sc">%&gt;%</span> <span class="fu">diff</span>()</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">summary</span>(returns_exxon))</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">XOM.Adjusted</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Min. :-0.1502705</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">1st Qu.:-0.0076624</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Median : 0.0001225</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Mean : 0.0003904</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">3rd Qu.: 0.0085782</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Max. : 0.1586308</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>From the summary statistics, we can clearly see that the mean return is close to zero, but with significant deviation. This is characteristic of financial data, where over long periods, the mean return tends to be small. This behavior of returns—small and steady on average, with occasional bursts of high variation—is precisely what ARCH/GARCH models aim to capture and quantify.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the returns</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(returns_exxon, <span class="at">color=</span><span class="st">"dodgerblue3"</span>) <span class="sc">+</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Exxon Mobil Stock Price Returns"</span>) <span class="sc">+</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The plot shows the daily returns on Exxon Mobil’s stock from 1990 to 2024. The returns, calculated using logarithmic differences, fluctuate around zero, with spikes that indicate days of particularly high volatility. The distribution of returns is fairly symmetric, there is volatility clustering in the returns.</p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a time series object</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>Chevron_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Chevron_stockprice<span class="sc">$</span>CVX.Adjusted, <span class="at">start=</span><span class="fu">decimal_date</span>(<span class="fu">as.Date</span>(<span class="st">"1990-01-01"</span>)), <span class="at">frequency =</span> <span class="fl">365.25</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate log returns</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>returns_chevron <span class="ot">&lt;-</span> <span class="fu">log</span>(Chevron_ts)<span class="sc">%&gt;%</span> <span class="fu">diff</span>()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">summary</span>(returns_chevron))</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">CVX.Adjusted</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Min. :-0.2500624</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">1st Qu.:-0.0079876</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Median : 0.0004270</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Mean : 0.0004046</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">3rd Qu.: 0.0089660</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Max. : 0.2049038</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The summary statistics for Chevron’s returns highlight a median value slightly above zero, suggesting that half of the observed returns were positive over the long term. However, the minimum and maximum values point to significant swings in the stock’s performance.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the returns</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(returns_chevron, <span class="at">color=</span><span class="st">"dodgerblue3"</span>) <span class="sc">+</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Chevron Stock Price Returns"</span>) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The plotted returns of Chevron’s stock, similar to Exxon Mobil’s, show clusters of volatility. These clusters where the spikes are denser indicate periods of heightened uncertainty or market activity. This pattern is a key feature that the forthcoming ARCH/GARCH analysis will aim to capture.</p>
</div>
</div>
</div>
</section>
<section id="acfpacf-plots" class="level1">
<h1>4. ACF/PACF Plots</h1>
<p>To further investigate the nature of the stock price returns and prepare for ARCH/GARCH modeling, it’s essential to look at the autocorrelations.</p>
<p>Autocorrelation Function (ACF) and Partial Autocorrelation Function (PACF) plots help us identify whether returns are influenced by their own past values (autocorrelation) and to what extent (partial autocorrelation). This step is key in determining the appropriate lag order for the ARCH/GARCH models.</p>
<section id="returns" class="level2">
<h2 class="anchored" data-anchor-id="returns">4.1 Returns</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Exxon Mobil</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Chevron Corporation</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ACF Plot for Exxon Mobil Stock</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>Exxon_acf <span class="ot">&lt;-</span> <span class="fu">ggAcf</span>(returns_exxon,<span class="dv">40</span>) <span class="sc">+</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"ACF Plot for Exxon Mobil Returns "</span>) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#PACF Plot for Exxon Mobil Stock</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>Exxon_pacf <span class="ot">&lt;-</span> <span class="fu">ggPacf</span>(returns_exxon,<span class="dv">40</span>) <span class="sc">+</span> </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"PACF Plot for Exxon Mobil Returns"</span>) <span class="sc">+</span> </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(Exxon_acf, Exxon_pacf, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Upon examining the ACF and PACF plots we can see values quickly drop off and mostly lie within the significance bounds, the returns appear to be stationary. Possible q and p values would be q = 0, 1, 2 and p = 0, 1, 2</p>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ACF Plot for Chevron Stock</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>Chevron_acf <span class="ot">&lt;-</span> <span class="fu">ggAcf</span>(returns_chevron,<span class="dv">40</span>) <span class="sc">+</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"ACF Plot for Chevron Stock Returns"</span>) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">#PACF Plot for Chevron Stock</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>Chevron_pacf <span class="ot">&lt;-</span> <span class="fu">ggPacf</span>(returns_chevron,<span class="dv">40</span>) <span class="sc">+</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"PACF Plot for Chevron Stock Returns"</span>) <span class="sc">+</span> </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(Chevron_acf, Chevron_pacf, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Upon examining the ACF and PACF plots we can see values quickly drop off and mostly lie within the significance bounds, the returns appear to be stationary. Possible q and p values would be q = 0, 1 and p = 0, 1</p>
</div>
</div>
</div>
</section>
<section id="absolute-returns" class="level2">
<h2 class="anchored" data-anchor-id="absolute-returns">4.2 Absolute Returns</h2>
<p>The ACF and PACF plots for the absolute returns give us insights into the nature of volatility in the stock’s returns. When we analyze absolute returns, we’re focusing on the magnitude of changes, regardless of direction, which can often reveal volatility patterns.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Exxon Mobil</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Chevron Corporation</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ACF Plot for Exxon Mobil Stock</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>Exxon_acf_abs <span class="ot">&lt;-</span> <span class="fu">ggAcf</span>(<span class="fu">abs</span>(returns_exxon),<span class="at">lag.max=</span><span class="dv">40</span>) <span class="sc">+</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"ACF Plot for Exxon Mobil Absolute Returns"</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#PACF Plot for Exxon Mobil Stock</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>Exxon_pacf_abs <span class="ot">&lt;-</span> <span class="fu">ggPacf</span>(<span class="fu">abs</span>(returns_exxon),<span class="at">lag.max=</span><span class="dv">40</span>) <span class="sc">+</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"PACF Plot for Exxon Mobil Absolute Returns"</span>) <span class="sc">+</span> </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(Exxon_acf_abs, Exxon_pacf_abs, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The ACF plot for the absolute returns shows significant autocorrelation across several lags, this indicates persistent volatility in the stock price returns. This is also indicative of the volatility clustering seen in financial time series.</p>
<p>The PACF plot shows significant correlations at the early lags (from 1 to 11, then at 17 and 18). After these initial lags, the correlations in the PACF plot decrease and generally stay within the confidence interval</p>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ACF Plot for Chevron Stock</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>Chevron_acf_abs <span class="ot">&lt;-</span> <span class="fu">ggAcf</span>(<span class="fu">abs</span>(returns_chevron),<span class="dv">40</span>) <span class="sc">+</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"ACF Plot for Chevron Stock Absolute Returns"</span>) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#PACF Plot for Chevron Stock</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>Chevron_pacf_abs <span class="ot">&lt;-</span> <span class="fu">ggPacf</span>(<span class="fu">abs</span>(returns_chevron),<span class="dv">40</span>) <span class="sc">+</span> </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"PACF Plot for Chevron Stock Absolute Returns"</span>) <span class="sc">+</span> </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(Chevron_acf_abs, Chevron_pacf_abs, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The ACF plot for the absolute returns shows significant autocorrelation across all the lags, this indicates persistent volatility in the stock price returns. This is also indicative of the volatility clustering seen in financial time series.</p>
<p>The PACF plot shows significant correlations at the early lags (from 1 to 11). After these initial lags, the correlations in the PACF plot decrease and generally stay within the confidence interval</p>
</div>
</div>
</div>
</section>
<section id="squared-returns" class="level2">
<h2 class="anchored" data-anchor-id="squared-returns">4.3 Squared Returns</h2>
<p>Examining squared returns is a technique in time series analysis to assess volatility patterns. When returns are squared, patterns in volatility might become more evident, as periods of high volatility will result in higher squared returns. These patterns are crucial for ARCH/GARCH models.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Exxon Mobil</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Chevron Corporation</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ACF Plot for Exxon Mobil Squared Returns</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>Exxon_acf_se <span class="ot">&lt;-</span> <span class="fu">ggAcf</span>(returns_exxon<span class="sc">^</span><span class="dv">2</span>, <span class="at">lag.max=</span><span class="dv">40</span>) <span class="sc">+</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"ACF Plot for Exxon Mobil Squared Returns"</span>) <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># PACF Plot for Exxon Mobil Squared Returns</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>Exxon_pacf_se <span class="ot">&lt;-</span> <span class="fu">ggPacf</span>(returns_exxon<span class="sc">^</span><span class="dv">2</span>, <span class="at">lag.max=</span><span class="dv">40</span>) <span class="sc">+</span> </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"PACF Plot for Exxon Mobil Squared Returns"</span>) <span class="sc">+</span> </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange the plots on a grid</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(Exxon_acf_se, Exxon_pacf_se, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The ACF plot for squared returns shows a much slower decay, indicating that volatility shocks have a long-lasting effect. The ACF plot here suggests that volatility shocks to Exxon Mobil’s stock prices are persistent, with a high level of autocorrelation extending across many lags.</p>
<p>The PACF plot for squared returns, while also showing some significant lags, doesn’t carry the same pattern of persistence as the ACF.</p>
<p>This persistence of volatility as indicated by the squared returns ACF and PACF plots reinforces the need for a GARCH model in capturing the time-varying volatility in the stock returns</p>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ACF Plot for Chevron Stock</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>Chevron_acf_se <span class="ot">&lt;-</span> <span class="fu">ggAcf</span>(returns_chevron<span class="sc">^</span><span class="dv">2</span>,<span class="dv">40</span>) <span class="sc">+</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"ACF Plot for Chevron Stock Squared Returns"</span>) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">#PACF Plot for Chevron Stock</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>Chevron_pacf_se <span class="ot">&lt;-</span> <span class="fu">ggPacf</span>(returns_chevron<span class="sc">^</span><span class="dv">2</span>,<span class="dv">40</span>) <span class="sc">+</span> </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"PACF Plot for Chevron Stock Squared Returns"</span>) <span class="sc">+</span> </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(Chevron_acf_se, Chevron_pacf_se, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The ACF plot here suggests that volatility shocks are persistent, with a high level of autocorrelation.</p>
<p>The PACF plot for squared returns, while also showing some significant lags, doesn’t carry the same pattern of persistence as the ACF.</p>
<p>This persistence of volatility as indicated by the squared returns ACF and PACF plots reinforces the need for a GARCH model in capturing the time-varying volatility in the stock returns</p>
</div>
</div>
</div>
</section>
</section>
<section id="arch-test" class="level1">
<h1>5. ARCH Test</h1>
<p>Before fitting an ARCH or GARCH model, it is important to formally test for the presence of ARCH effects that is, to test whether there are autoregressive conditional heteroskedasticity features in the time series data.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">Exxon Mobil</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Chevron Corporation</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Conduct the ARCH test</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ArchTest</span>(returns_exxon, <span class="at">lags=</span><span class="dv">1</span>, <span class="at">demean=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    ARCH LM-test; Null hypothesis: no ARCH effects

data:  returns_exxon
Chi-squared = 590.59, df = 1, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<p>The result of the ARCH test indicates a Chi-squared statistic of 590.35 with 1 degree of freedom and a p-value less than 2.2e-16, which is extremely low. This leads us to reject the null hypothesis of no ARCH effects. There is very strong evidence of autoregressive conditional heteroskedasticity in the Exxon Mobil stock returns.</p>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Conduct the ARCH test</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ArchTest</span>(returns_chevron, <span class="at">lags=</span><span class="dv">1</span>, <span class="at">demean=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    ARCH LM-test; Null hypothesis: no ARCH effects

data:  returns_chevron
Chi-squared = 260.66, df = 1, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<p>The result of the ARCH test indicates a Chi-squared statistic of 260.57 with 1 degree of freedom and a p-value less than 2.2e-16, which is extremely low. This leads us to reject the null hypothesis of no ARCH effects. There is very strong evidence of autoregressive conditional heteroskedasticity.</p>
</div>
</div>
</div>
<p>Given these results, it is appropriate to proceed with fitting an ARCH/GARCH model to the stock returns to better understand and predict the volatility patterns.</p>
</section>
<section id="fitting-arima-model" class="level1">
<h1>6. Fitting ARIMA model</h1>
<p>When volatility clustering is present, as indicated by the ARCH test, it’s good practice to first model the mean of the time series. An ARIMA model helps in capturing the autocorrelation in the mean of the series. Once we’ve accounted for any autocorrelation in the mean with the ARIMA model, we can proceed to model the conditional variance (volatility) using GARCH models.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">Exxon Mobil</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Chevron Corporation</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<p>To find the best ARIMA model, we search across different combinations of p (autoregressive terms), d (differencing terms), and q (moving average terms), and select the model with the lowest information criteria (AIC, BIC, and AICc).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ARIMA.c<span class="ot">=</span><span class="cf">function</span>(p1,p2,q1,q2,data){</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">=</span><span class="fu">c</span>()</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#d=1</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>i<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>ls<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,<span class="dv">6</span><span class="sc">*</span><span class="dv">18</span>),<span class="at">nrow=</span><span class="dv">18</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (p <span class="cf">in</span> p1<span class="sc">:</span>p2)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(q <span class="cf">in</span> q1<span class="sc">:</span>q2)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(d <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(p<span class="sc">+</span>d<span class="sc">+</span>q<span class="sc">&lt;=</span><span class="dv">6</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>        model<span class="ot">&lt;-</span> <span class="fu">Arima</span>(data,<span class="at">order=</span><span class="fu">c</span>(p,d,q))</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>        ls[i,]<span class="ot">=</span> <span class="fu">c</span>(p,d,q,model<span class="sc">$</span>aic,model<span class="sc">$</span>bic,model<span class="sc">$</span>aicc)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>        i<span class="ot">=</span>i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">=</span> <span class="fu">as.data.frame</span>(ls)</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(temp)<span class="ot">=</span> <span class="fu">c</span>(<span class="st">"p"</span>,<span class="st">"d"</span>,<span class="st">"q"</span>,<span class="st">"AIC"</span>,<span class="st">"BIC"</span>,<span class="st">"AICc"</span>)</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>temp</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">ARIMA.c</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="at">data=</span>returns_exxon) </span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>output</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   p d q       AIC       BIC      AICc
1  0 0 0 -47325.61 -47311.48 -47325.61
2  0 1 0 -40705.96 -40698.89 -40705.95
3  0 0 1 -47377.39 -47356.20 -47377.39
4  0 1 1 -47310.08 -47295.95 -47310.07
5  0 0 2 -47399.70 -47371.44 -47399.69
6  0 1 2 -47361.67 -47340.48 -47361.67
7  1 0 0 -47371.58 -47350.38 -47371.57
8  1 1 0 -43325.81 -43311.67 -43325.80
9  1 0 1 -47402.49 -47374.23 -47402.48
10 1 1 1 -47355.89 -47334.69 -47355.89
11 1 0 2 -47400.88 -47365.55 -47400.87
12 1 1 2 -47386.54 -47358.28 -47386.54
13 2 0 0 -47396.49 -47368.22 -47396.48
14 2 1 0 -44551.13 -44529.94 -44551.13
15 2 0 1 -47400.82 -47365.49 -47400.81
16 2 1 1 -47380.69 -47352.43 -47380.68
17 2 0 2 -47399.60 -47357.21 -47399.59
18 2 1 2 -47384.92 -47349.60 -47384.91</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>AIC),] </span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  p d q       AIC       BIC      AICc
9 1 0 1 -47402.49 -47374.23 -47402.48</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>BIC),] </span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  p d q       AIC       BIC      AICc
9 1 0 1 -47402.49 -47374.23 -47402.48</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>AICc),] </span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  p d q       AIC       BIC      AICc
9 1 0 1 -47402.49 -47374.23 -47402.48</code></pre>
</div>
</div>
<p>The best ARIMA model according to the lowest AIC, BIC and AICC is ARIMA(1,0,1)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fit_exxon <span class="ot">&lt;-</span> <span class="fu">Arima</span>(returns_exxon,<span class="at">order=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_exxon)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: returns_exxon 
ARIMA(1,0,1) with non-zero mean 

Coefficients:
         ar1      ma1   mean
      0.5304  -0.6125  4e-04
s.e.  0.0729   0.0679  1e-04

sigma^2 = 0.000244:  log likelihood = 23705.24
AIC=-47402.49   AICc=-47402.48   BIC=-47374.23

Training set error measures:
                        ME       RMSE        MAE MPE MAPE      MASE        ACF1
Training set -2.599336e-06 0.01561646 0.01100092 NaN  Inf 0.6700663 0.001754744</code></pre>
</div>
</div>
<p>The standard errors are relatively small compared to the coefficients, suggesting that the coefficients are likely to be significantly different from zero.</p>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<p>To find the best ARIMA model, we search across different combinations of p (autoregressive terms), d (differencing terms), and q (moving average terms), and select the model with the lowest information criteria (AIC, BIC, and AICc).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ARIMA.c<span class="ot">=</span><span class="cf">function</span>(p1,p2,q1,q2,data){</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">=</span><span class="fu">c</span>()</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">#d=1</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>i<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>ls<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,<span class="dv">6</span><span class="sc">*</span><span class="dv">18</span>),<span class="at">nrow=</span><span class="dv">18</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (p <span class="cf">in</span> p1<span class="sc">:</span>p2)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(q <span class="cf">in</span> q1<span class="sc">:</span>q2)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(d <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(p<span class="sc">+</span>d<span class="sc">+</span>q<span class="sc">&lt;=</span><span class="dv">6</span>)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>        model<span class="ot">&lt;-</span> <span class="fu">Arima</span>(data,<span class="at">order=</span><span class="fu">c</span>(p,d,q))</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>        ls[i,]<span class="ot">=</span> <span class="fu">c</span>(p,d,q,model<span class="sc">$</span>aic,model<span class="sc">$</span>bic,model<span class="sc">$</span>aicc)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>        i<span class="ot">=</span>i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">=</span> <span class="fu">as.data.frame</span>(ls)</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(temp)<span class="ot">=</span> <span class="fu">c</span>(<span class="st">"p"</span>,<span class="st">"d"</span>,<span class="st">"q"</span>,<span class="st">"AIC"</span>,<span class="st">"BIC"</span>,<span class="st">"AICc"</span>)</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>temp</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">ARIMA.c</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="at">data=</span>returns_chevron) </span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>output</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   p d q       AIC       BIC      AICc
1  0 0 0 -46434.21 -46420.08 -46434.21
2  0 1 0 -39813.17 -39806.11 -39813.17
3  0 0 1 -46481.90 -46460.71 -46481.90
4  0 1 1 -46418.78 -46404.65 -46418.78
5  0 0 2 -46481.15 -46452.89 -46481.14
6  0 1 2 -46466.30 -46445.11 -46466.30
7  1 0 0 -46480.46 -46459.27 -46480.46
8  1 1 0 -42654.57 -42640.44 -42654.57
9  1 0 1 -46481.30 -46453.04 -46481.29
10 1 1 1 -46464.88 -46443.68 -46464.88
11 1 0 2 -46479.14 -46443.81 -46479.13
12 1 1 2 -46463.86 -46435.60 -46463.85
13 2 0 0 -46481.03 -46452.77 -46481.02
14 2 1 0 -43831.37 -43810.18 -43831.37
15 2 0 1 -46479.04 -46443.71 -46479.03
16 2 1 1 -46465.41 -46437.15 -46465.41
17 2 0 2 -46477.40 -46435.01 -46477.39
18 2 1 2 -46468.80 -46433.47 -46468.79</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>AIC),] </span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  p d q      AIC       BIC     AICc
3 0 0 1 -46481.9 -46460.71 -46481.9</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>BIC),] </span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  p d q      AIC       BIC     AICc
3 0 0 1 -46481.9 -46460.71 -46481.9</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>output[<span class="fu">which.min</span>(output<span class="sc">$</span>AICc),] </span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  p d q      AIC       BIC     AICc
3 0 0 1 -46481.9 -46460.71 -46481.9</code></pre>
</div>
</div>
<p>The best ARIMA model according to the lowest AIC is ARIMA(0,0,1)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>fit_chevron <span class="ot">&lt;-</span> <span class="fu">Arima</span>(returns_chevron,<span class="at">order=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_chevron)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: returns_chevron 
ARIMA(0,0,1) with non-zero mean 

Coefficients:
          ma1   mean
      -0.0768  4e-04
s.e.   0.0109  2e-04

sigma^2 = 0.0002714:  log likelihood = 23243.95
AIC=-46481.9   AICc=-46481.9   BIC=-46460.71

Training set error measures:
                       ME       RMSE        MAE MPE MAPE      MASE         ACF1
Training set 2.755876e-08 0.01647188 0.01143922 NaN  Inf 0.6711245 0.0009039099</code></pre>
</div>
</div>
<p>The zero autocorrelation at the first lag (ACF1) of residuals indicates that the model is capturing the correlation in the data quite well.</p>
</div>
</div>
</div>
</section>
<section id="analyising-the-residuals" class="level1">
<h1>7. Analyising the Residuals</h1>
<p>Now we will analyse the residual in depth, this step is crucial because any pattern left in the residuals can indicate that the model hasn’t fully captured the underlying process.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">Exxon Mobil</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Chevron Corporation</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<p>After fitting an ARIMA(1,0,1) model to the Exxon Mobil returns, we need to analyze the residuals to ensure that the model has captured the data’s structure adequately.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>model_output_e <span class="ot">&lt;-</span> <span class="fu">capture.output</span>(<span class="fu">sarima</span>(returns_exxon,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#model_output_e</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(model_output_e[<span class="dv">22</span><span class="sc">:</span><span class="dv">34</span>], model_output_e[<span class="fu">length</span>(model_output_e)], <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) </span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>converged
&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;
 
Coefficients: 
      Estimate     SE t.value p.value
ar1     0.5304 0.0729  7.2769  0.0000
ma1    -0.6125 0.0679 -9.0166  0.0000
xmean   0.0004 0.0001  2.8264  0.0047

sigma^2 estimated as 0.0002438737 on 8647 degrees of freedom 
 
AIC = -5.480056  AICc = -5.480056  BIC = -5.476789 
 
 </code></pre>
</div>
</div>
<p>The Standardized Residuals plot does show some volatility left, just before 2000, between 2003 and 2004 and around 2010 to 2011. These spikes indicate that the ARIMA model may not have fully captured the variability during these periods.</p>
<p>The coefficient estimates and their corresponding standard errors, t-values, and p-values confirm the significance of the AR1 and MA1 terms.</p>
<p>Moving forward with the analysis, after fitting an ARIMA(1,0,1) model, we will now examine the autocorrelation in both the residuals and the squared residuals. This step is crucial as it helps us to understand the nature of the residuals and assess whether a GARCH model is necessary.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>exxon.res<span class="ot">&lt;-</span>fit_exxon<span class="sc">$</span>residuals</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggAcf</span>(exxon.res, <span class="dv">40</span>) <span class="sc">+</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>plot2<span class="ot">&lt;-</span> <span class="fu">ggPacf</span>(exxon.res, <span class="dv">40</span>) <span class="sc">+</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(plot1, plot2,<span class="at">nrow=</span><span class="dv">2</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The autocorrelations appear to be within the confidence bands for most lags, suggesting there is no significant autocorrelation remaining in the residuals. Similarly, the PACF shows that the partial autocorrelations are also within the confidence bounds for most of the lags</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>plot3 <span class="ot">&lt;-</span> <span class="fu">ggAcf</span>(exxon.res<span class="sc">^</span><span class="dv">2</span>, <span class="dv">40</span>) <span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>plot4<span class="ot">&lt;-</span> <span class="fu">ggPacf</span>(exxon.res<span class="sc">^</span><span class="dv">2</span>, <span class="dv">40</span>) <span class="sc">+</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(plot3, plot4,<span class="at">nrow=</span><span class="dv">2</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The slow decay in autocorrelation across lags indicates that there is high volatility clustering. The PACF plot also shows some spikes at early lags, suggesting that there is some volatility.</p>
<p>These plots are indicative of conditional heteroskedasticity in the series, which is not captured by the ARIMA model. It is recommended to proceed with fitting a GARCH model. The significant ACF in the squared residuals indicates that a GARCH(1,1) model is appropriate.</p>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<p>After fitting an ARIMA(0,0,1) model to the Chevron returns, we need to analyze the residuals to ensure that the model has captured the data’s structure adequately.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>model_output_c <span class="ot">&lt;-</span> <span class="fu">capture.output</span>(<span class="fu">sarima</span>(returns_chevron,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#model_output_c</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(model_output_c[<span class="dv">11</span><span class="sc">:</span><span class="dv">22</span>], model_output_c[<span class="fu">length</span>(model_output_c)], <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) </span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>converged
&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;
 
Coefficients: 
      Estimate     SE t.value p.value
ma1    -0.0768 0.0109 -7.0782  0.0000
xmean   0.0004 0.0002  2.4693  0.0136

sigma^2 estimated as 0.0002713227 on 8648 degrees of freedom 
 
AIC = -5.37363  AICc = -5.37363  BIC = -5.37118 
 
 </code></pre>
</div>
</div>
<p>The Standardized Residuals plot does show some volatility left, around 2003, and then 2010 to 2012. These spikes indicate that the ARIMA model may not have fully captured the variability during these periods.</p>
<p>Both the coefficient estimates are significant.</p>
<p>Moving forward with the analysis, after fitting an ARIMA(0,0,1) model, we will now examine the autocorrelation in both the residuals and the squared residuals. This step is crucial as it helps us to understand the nature of the residuals and assess whether a GARCH model is necessary.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>chevron.res<span class="ot">&lt;-</span>fit_chevron<span class="sc">$</span>residuals</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>plot5 <span class="ot">&lt;-</span> <span class="fu">ggAcf</span>(chevron.res, <span class="dv">40</span>) <span class="sc">+</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>plot6 <span class="ot">&lt;-</span> <span class="fu">ggPacf</span>(chevron.res, <span class="dv">40</span>) <span class="sc">+</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(plot5, plot6,<span class="at">nrow=</span><span class="dv">2</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The autocorrelations appear to be within the confidence bands for most lags, suggesting there is no significant autocorrelation remaining in the residuals. Similarly, the PACF shows that the partial autocorrelations are also within the confidence bounds for most of the lags</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>plot7 <span class="ot">&lt;-</span> <span class="fu">ggAcf</span>(chevron.res<span class="sc">^</span><span class="dv">2</span>, <span class="dv">40</span>) <span class="sc">+</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>plot8 <span class="ot">&lt;-</span> <span class="fu">ggPacf</span>(chevron.res<span class="sc">^</span><span class="dv">2</span>, <span class="dv">40</span>) <span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(plot7,plot8,<span class="at">nrow=</span><span class="dv">2</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The slow decay in autocorrelation across lags indicates that there is high volatility clustering. The PACF plot also shows some spikes at early lags (from 1 to 9), suggesting that there is some volatility.</p>
<p>These plots are indicative of conditional heteroskedasticity in the series, which is not captured by the ARIMA model. It is recommended to proceed with fitting a GARCH model. The significant ACF in the squared residuals indicates that a GARCH(1,1) model is appropriate.</p>
</div>
</div>
</div>
</section>
<section id="method-1-garch-model-on-arima-residuals" class="level1">
<h1>8. Method 1: GARCH Model on ARIMA Residuals</h1>
<p>After determining the presence of conditional heteroskedasticity in the residuals of the ARIMA model, we proceed with fitting a GARCH model. The GARCH model is designed to model the volatility clustering evident in financial time series, allowing for more accurate forecasting of risk and volatility.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">Exxon Mobil</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Chevron Corporation</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">list</span>() </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (p <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>) {</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>) {</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressWarnings</span>({</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>      model[[cc]] <span class="ot">&lt;-</span> <span class="fu">garch</span>(exxon.res, <span class="at">order=</span><span class="fu">c</span>(p,q), <span class="at">trace=</span>F)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    cc <span class="ot">&lt;-</span> cc <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="do">## get AIC values for model evaluation</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>GARCH_AIC <span class="ot">&lt;-</span> <span class="fu">sapply</span>(model, AIC) <span class="do">## model with lowest AIC is the best</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(GARCH_AIC <span class="sc">==</span> <span class="fu">min</span>(GARCH_AIC))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>model[[<span class="fu">which</span>(GARCH_AIC <span class="sc">==</span> <span class="fu">min</span>(GARCH_AIC))]]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
garch(x = exxon.res, order = c(p, q), trace = F)

Coefficient(s):
       a0         a1         b1  
2.446e-06  7.076e-02  9.190e-01  </code></pre>
</div>
</div>
<p>The model with the lowest AIC appears to be a GARCH (1,1). Now lets fit GARCH (1,1)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Fit the GARCH(1,1) model on the residuals</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>garch_fit_exxon <span class="ot">&lt;-</span> <span class="fu">garchFit</span>(<span class="sc">~</span><span class="fu">garch</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">data =</span> exxon.res, <span class="at">trace =</span> F)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Summary of the fitted GARCH model</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(garch_fit_exxon)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Title:
 GARCH Modelling 

Call:
 garchFit(formula = ~garch(1, 1), data = exxon.res, trace = F) 

Mean and Variance Equation:
 data ~ garch(1, 1)
&lt;environment: 0x107b6e828&gt;
 [data = exxon.res]

Conditional Distribution:
 norm 

Coefficient(s):
        mu       omega      alpha1       beta1  
2.5993e-05  2.4488e-06  7.0824e-02  9.1892e-01  

Std. Errors:
 based on Hessian 

Error Analysis:
        Estimate  Std. Error  t value Pr(&gt;|t|)    
mu     2.599e-05   1.289e-04    0.202     0.84    
omega  2.449e-06   3.988e-07    6.141 8.21e-10 ***
alpha1 7.082e-02   5.375e-03   13.176  &lt; 2e-16 ***
beta1  9.189e-01   6.108e-03  150.444  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Log Likelihood:
 25012.55    normalized:  2.891624 

Description:
 Sun May  5 18:33:10 2024 by user:  


Standardised Residuals Tests:
                                Statistic p-Value   
 Jarque-Bera Test   R    Chi^2  662.9813  0         
 Shapiro-Wilk Test  R    W      NA        NA        
 Ljung-Box Test     R    Q(10)  19.93908  0.02983422
 Ljung-Box Test     R    Q(15)  22.27227  0.1008611 
 Ljung-Box Test     R    Q(20)  32.00702  0.0432236 
 Ljung-Box Test     R^2  Q(10)  21.06936  0.02061506
 Ljung-Box Test     R^2  Q(15)  28.53337  0.01845906
 Ljung-Box Test     R^2  Q(20)  30.91429  0.05633217
 LM Arch Test       R    TR^2   24.28011  0.01862777

Information Criterion Statistics:
      AIC       BIC       SIC      HQIC 
-5.782324 -5.779056 -5.782324 -5.781210 </code></pre>
</div>
</div>
<p>All coefficients (omega, alpha1, beta1) are highly significant. This implies that the GARCH(1,1) model captures the volatility clustering effectively.</p>
<p>The best model according to method 1 is ARIMA(1,0,1) + GARCH(1,1).</p>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">list</span>() </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (p <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>) {</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>) {</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressWarnings</span>({</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>      model[[cc]] <span class="ot">&lt;-</span> <span class="fu">garch</span>(chevron.res, <span class="at">order=</span><span class="fu">c</span>(p,q), <span class="at">trace=</span>F)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    cc <span class="ot">&lt;-</span> cc <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="do">## get AIC values for model evaluation</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>GARCH_AIC <span class="ot">&lt;-</span> <span class="fu">sapply</span>(model, AIC) <span class="do">## model with lowest AIC is the best</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(GARCH_AIC <span class="sc">==</span> <span class="fu">min</span>(GARCH_AIC))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>model[[<span class="fu">which</span>(GARCH_AIC <span class="sc">==</span> <span class="fu">min</span>(GARCH_AIC))]]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
garch(x = chevron.res, order = c(p, q), trace = F)

Coefficient(s):
       a0         a1         b1  
3.980e-06  7.028e-02  9.132e-01  </code></pre>
</div>
</div>
<p>The model with the lowest AIC appears to be a GARCH (1,1). Now lets fit GARCH (1,1)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Fit the GARCH(1,1) model on the residuals</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>garch_fit_chevron <span class="ot">&lt;-</span> <span class="fu">garchFit</span>(<span class="sc">~</span><span class="fu">garch</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">data =</span> chevron.res, <span class="at">trace =</span> F)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Summary of the fitted GARCH model</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(garch_fit_chevron)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Title:
 GARCH Modelling 

Call:
 garchFit(formula = ~garch(1, 1), data = chevron.res, trace = F) 

Mean and Variance Equation:
 data ~ garch(1, 1)
&lt;environment: 0x107e20f78&gt;
 [data = chevron.res]

Conditional Distribution:
 norm 

Coefficient(s):
        mu       omega      alpha1       beta1  
2.7593e-08  3.9797e-06  7.0278e-02  9.1320e-01  

Std. Errors:
 based on Hessian 

Error Analysis:
        Estimate  Std. Error  t value Pr(&gt;|t|)    
mu     2.759e-08   1.393e-04    0.000        1    
omega  3.980e-06   5.763e-07    6.906 4.99e-12 ***
alpha1 7.028e-02   5.251e-03   13.383  &lt; 2e-16 ***
beta1  9.132e-01   6.499e-03  140.515  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Log Likelihood:
 24545.54    normalized:  2.837635 

Description:
 Sun May  5 18:33:12 2024 by user:  


Standardised Residuals Tests:
                                Statistic p-Value     
 Jarque-Bera Test   R    Chi^2  983.1367  0           
 Shapiro-Wilk Test  R    W      NA        NA          
 Ljung-Box Test     R    Q(10)  35.10628  0.0001197562
 Ljung-Box Test     R    Q(15)  38.88622  0.0006664173
 Ljung-Box Test     R    Q(20)  50.08895  0.0002150749
 Ljung-Box Test     R^2  Q(10)  18.63892  0.04509597  
 Ljung-Box Test     R^2  Q(15)  19.8402   0.178149    
 Ljung-Box Test     R^2  Q(20)  26.67559  0.1446401   
 LM Arch Test       R    TR^2   18.72892  0.09528387  

Information Criterion Statistics:
      AIC       BIC       SIC      HQIC 
-5.674345 -5.671077 -5.674345 -5.673231 </code></pre>
</div>
</div>
<p>All coefficients (omega, alpha1, beta1) are highly significant, with very small p-values. This implies that the GARCH(1,1) model captures the volatility clustering effectively. The high log likelihood suggest that the model is a good fit.</p>
<p>The GARCH(1,1) model effectively captures the conditional heteroscedasticity of Chevron’s stock returns.</p>
<p>The best model according to method 1 is ARIMA(0,0,1) + GARCH(1,1).</p>
</div>
</div>
</div>
</section>
<section id="method-2-garch-model" class="level1">
<h1>9. Method 2: GARCH Model</h1>
<p>The GARCH model is designed to model the volatility clustering evident in financial time series, allowing for more accurate forecasting of risk and volatility. Here we will fit the model on the returns</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">Exxon Mobil</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Chevron Corporation</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">list</span>() </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (p <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>) {</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>) {</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressWarnings</span>({</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>      model[[cc]] <span class="ot">&lt;-</span> <span class="fu">garch</span>(returns_exxon, <span class="at">order=</span><span class="fu">c</span>(p,q), <span class="at">trace=</span>F)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    cc <span class="ot">&lt;-</span> cc <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="do">## get AIC values for model evaluation</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>GARCH_AIC <span class="ot">&lt;-</span> <span class="fu">sapply</span>(model, AIC) <span class="do">## model with lowest AIC is the best</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(GARCH_AIC <span class="sc">==</span> <span class="fu">min</span>(GARCH_AIC))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>model[[<span class="fu">which</span>(GARCH_AIC <span class="sc">==</span> <span class="fu">min</span>(GARCH_AIC))]]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
garch(x = returns_exxon, order = c(p, q), trace = F)

Coefficient(s):
       a0         a1         b1  
2.388e-06  6.937e-02  9.207e-01  </code></pre>
</div>
</div>
<p>GARCH(1,1) model has the lowest AIC.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>garch_fit_returns_exxon <span class="ot">&lt;-</span> <span class="fu">garchFit</span>(<span class="sc">~</span><span class="fu">garch</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">data =</span> returns_exxon, <span class="at">trace =</span> F)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(garch_fit_returns_exxon)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Title:
 GARCH Modelling 

Call:
 garchFit(formula = ~garch(1, 1), data = returns_exxon, trace = F) 

Mean and Variance Equation:
 data ~ garch(1, 1)
&lt;environment: 0x1082a3b40&gt;
 [data = returns_exxon]

Conditional Distribution:
 norm 

Coefficient(s):
        mu       omega      alpha1       beta1  
5.1633e-04  2.4198e-06  7.0487e-02  9.1944e-01  

Std. Errors:
 based on Hessian 

Error Analysis:
        Estimate  Std. Error  t value Pr(&gt;|t|)    
mu     5.163e-04   1.276e-04    4.046 5.22e-05 ***
omega  2.420e-06   3.965e-07    6.103 1.04e-09 ***
alpha1 7.049e-02   5.333e-03   13.216  &lt; 2e-16 ***
beta1  9.194e-01   6.049e-03  151.997  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Log Likelihood:
 24990.29    normalized:  2.889051 

Description:
 Sun May  5 18:33:15 2024 by user:  


Standardised Residuals Tests:
                                Statistic p-Value    
 Jarque-Bera Test   R    Chi^2  617.3581  0          
 Shapiro-Wilk Test  R    W      NA        NA         
 Ljung-Box Test     R    Q(10)  28.03498  0.001782117
 Ljung-Box Test     R    Q(15)  30.81187  0.009308218
 Ljung-Box Test     R    Q(20)  41.90705  0.002843746
 Ljung-Box Test     R^2  Q(10)  21.49168  0.01791427 
 Ljung-Box Test     R^2  Q(15)  29.10062  0.01561133 
 Ljung-Box Test     R^2  Q(20)  31.51951  0.04869507 
 LM Arch Test       R    TR^2   24.53467  0.01718853 

Information Criterion Statistics:
      AIC       BIC       SIC      HQIC 
-5.777177 -5.773910 -5.777178 -5.776063 </code></pre>
</div>
</div>
<p>All parameters in the model are statistically significant, as indicated by the p-values being less than 0.05.</p>
<p>Thus for method 2 fitting GARCH(1,1) model directly to the returns of Exxon Mobil is the best model.</p>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">list</span>() </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (p <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>) {</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (q <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>) {</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">suppressWarnings</span>({</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>      model[[cc]] <span class="ot">&lt;-</span> <span class="fu">garch</span>(returns_chevron, <span class="at">order=</span><span class="fu">c</span>(p,q), <span class="at">trace=</span>F)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>    cc <span class="ot">&lt;-</span> cc <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="do">## get AIC values for model evaluation</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>GARCH_AIC <span class="ot">&lt;-</span> <span class="fu">sapply</span>(model, AIC) <span class="do">## model with lowest AIC is the best</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(GARCH_AIC <span class="sc">==</span> <span class="fu">min</span>(GARCH_AIC))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>model[[<span class="fu">which</span>(GARCH_AIC <span class="sc">==</span> <span class="fu">min</span>(GARCH_AIC))]]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
garch(x = returns_chevron, order = c(p, q), trace = F)

Coefficient(s):
       a0         a1         b1  
3.889e-06  6.923e-02  9.146e-01  </code></pre>
</div>
</div>
<p>GARCH(1,1) model has the lowest AIC.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>garch_fit_returns_chevron <span class="ot">&lt;-</span> <span class="fu">garchFit</span>(<span class="sc">~</span><span class="fu">garch</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">data =</span> returns_chevron, <span class="at">trace =</span> F)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(garch_fit_returns_chevron)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Title:
 GARCH Modelling 

Call:
 garchFit(formula = ~garch(1, 1), data = returns_chevron, trace = F) 

Mean and Variance Equation:
 data ~ garch(1, 1)
&lt;environment: 0x10499f938&gt;
 [data = returns_chevron]

Conditional Distribution:
 norm 

Coefficient(s):
        mu       omega      alpha1       beta1  
6.3400e-04  3.9588e-06  7.0647e-02  9.1291e-01  

Std. Errors:
 based on Hessian 

Error Analysis:
        Estimate  Std. Error  t value Pr(&gt;|t|)    
mu     6.340e-04   1.381e-04    4.590 4.44e-06 ***
omega  3.959e-06   5.713e-07    6.929 4.24e-12 ***
alpha1 7.065e-02   5.247e-03   13.464  &lt; 2e-16 ***
beta1  9.129e-01   6.465e-03  141.201  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Log Likelihood:
 24555.55    normalized:  2.838792 

Description:
 Sun May  5 18:33:17 2024 by user:  


Standardised Residuals Tests:
                                Statistic p-Value   
 Jarque-Bera Test   R    Chi^2  970.1538  0         
 Shapiro-Wilk Test  R    W      NA        NA        
 Ljung-Box Test     R    Q(10)  8.52079   0.5781032 
 Ljung-Box Test     R    Q(15)  12.26653  0.658753  
 Ljung-Box Test     R    Q(20)  24.33091  0.2282363 
 Ljung-Box Test     R^2  Q(10)  19.84517  0.03075157
 Ljung-Box Test     R^2  Q(15)  21.10869  0.1333924 
 Ljung-Box Test     R^2  Q(20)  28.12466  0.1064811 
 LM Arch Test       R    TR^2   19.83904  0.0701927 

Information Criterion Statistics:
      AIC       BIC       SIC      HQIC 
-5.676658 -5.673391 -5.676659 -5.675544 </code></pre>
</div>
</div>
<p>All parameters in the model are statistically significant, as indicated by the p-values being less than 0.05. The significant mu, omega, alpha, and beta parameters ensure that the model not only captures the average price movements but also effectively models the observed volatility patterns.</p>
<p>The GARCH(1,1) model, applied directly to the returns, appears to be the optimal model.</p>
</div>
</div>
</div>
</section>
<section id="model-diagnostics" class="level1">
<h1>10. Model Diagnostics</h1>
<p>Now lets do Model Diagnostics for both the models selected in Method 1 and Method 2 above</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">Exxon Mobil</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">Chevron Corporation</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<section id="method-1-arima101-garch11" class="level3">
<h3 class="anchored" data-anchor-id="method-1-arima101-garch11">Method 1: ARIMA(1,0,1) + GARCH(1,1)</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_exxon)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: returns_exxon 
ARIMA(1,0,1) with non-zero mean 

Coefficients:
         ar1      ma1   mean
      0.5304  -0.6125  4e-04
s.e.  0.0729   0.0679  1e-04

sigma^2 = 0.000244:  log likelihood = 23705.24
AIC=-47402.49   AICc=-47402.48   BIC=-47374.23

Training set error measures:
                        ME       RMSE        MAE MPE MAPE      MASE        ACF1
Training set -2.599336e-06 0.01561646 0.01100092 NaN  Inf 0.6700663 0.001754744</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>garch_exxon <span class="ot">&lt;-</span> <span class="fu">garchFit</span>(<span class="sc">~</span><span class="fu">garch</span>(<span class="dv">1</span>,<span class="dv">1</span>), exxon.res,<span class="at">trace =</span> F)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(garch_exxon)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Title:
 GARCH Modelling 

Call:
 garchFit(formula = ~garch(1, 1), data = exxon.res, trace = F) 

Mean and Variance Equation:
 data ~ garch(1, 1)
&lt;environment: 0x107924a58&gt;
 [data = exxon.res]

Conditional Distribution:
 norm 

Coefficient(s):
        mu       omega      alpha1       beta1  
2.5993e-05  2.4488e-06  7.0824e-02  9.1892e-01  

Std. Errors:
 based on Hessian 

Error Analysis:
        Estimate  Std. Error  t value Pr(&gt;|t|)    
mu     2.599e-05   1.289e-04    0.202     0.84    
omega  2.449e-06   3.988e-07    6.141 8.21e-10 ***
alpha1 7.082e-02   5.375e-03   13.176  &lt; 2e-16 ***
beta1  9.189e-01   6.108e-03  150.444  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Log Likelihood:
 25012.55    normalized:  2.891624 

Description:
 Sun May  5 18:33:17 2024 by user:  


Standardised Residuals Tests:
                                Statistic p-Value   
 Jarque-Bera Test   R    Chi^2  662.9813  0         
 Shapiro-Wilk Test  R    W      NA        NA        
 Ljung-Box Test     R    Q(10)  19.93908  0.02983422
 Ljung-Box Test     R    Q(15)  22.27227  0.1008611 
 Ljung-Box Test     R    Q(20)  32.00702  0.0432236 
 Ljung-Box Test     R^2  Q(10)  21.06936  0.02061506
 Ljung-Box Test     R^2  Q(15)  28.53337  0.01845906
 Ljung-Box Test     R^2  Q(20)  30.91429  0.05633217
 LM Arch Test       R    TR^2   24.28011  0.01862777

Information Criterion Statistics:
      AIC       BIC       SIC      HQIC 
-5.782324 -5.779056 -5.782324 -5.781210 </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">garch</span>(exxon.res, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">trace =</span> F))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
garch(x = exxon.res, order = c(1, 1), trace = F)

Model:
GARCH(1,1)

Residuals:
      Min        1Q    Median        3Q       Max 
-5.625760 -0.615732  0.008398  0.627854  5.340306 

Coefficient(s):
    Estimate  Std. Error  t value Pr(&gt;|t|)    
a0 2.446e-06   2.800e-07    8.738   &lt;2e-16 ***
a1 7.076e-02   3.487e-03   20.294   &lt;2e-16 ***
b1 9.190e-01   3.896e-03  235.904   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Diagnostic Tests:
    Jarque Bera Test

data:  Residuals
X-squared = 663.64, df = 2, p-value &lt; 2.2e-16


    Box-Ljung test

data:  Squared.Residuals
X-squared = 4.6661, df = 1, p-value = 0.03076</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(<span class="fu">garch</span>(exxon.res, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">trace =</span> F))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals
Q* = 779.64, df = 730.5, p-value = 0.1011

Model df: 0.   Total lags used: 730.5</code></pre>
</div>
</div>
<p>The residuals do not show any obvious trends or seasonality, which suggests that the ARIMA model has captured the linear structure of the data. However, there are some visible outliers. Residuals are normally distributed, which supports one of the underlying assumptions of the ARIMA model.</p>
<p>The Ljung-Box test on residuals with a p-value of 0.1078 suggests that there is no significant autocorrelation in the residuals. This implies that the model residuals are random.</p>
<p>The coefficients of the GARCH(1,1) model are all statistically significant.</p>
</section>
<section id="method-2-garch11" class="level3">
<h3 class="anchored" data-anchor-id="method-2-garch11">Method 2: GARCH(1,1)</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>garch_returns_exxon1 <span class="ot">&lt;-</span> <span class="fu">garch</span>(returns_exxon, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">trace =</span> F)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(garch_returns_exxon1)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
garch(x = returns_exxon, order = c(1, 1), trace = F)

Model:
GARCH(1,1)

Residuals:
     Min       1Q   Median       3Q      Max 
-5.43615 -0.59095  0.01168  0.65546  5.29909 

Coefficient(s):
    Estimate  Std. Error  t value Pr(&gt;|t|)    
a0 2.388e-06   2.776e-07    8.601   &lt;2e-16 ***
a1 6.937e-02   3.474e-03   19.965   &lt;2e-16 ***
b1 9.207e-01   3.887e-03  236.850   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Diagnostic Tests:
    Jarque Bera Test

data:  Residuals
X-squared = 630.26, df = 2, p-value &lt; 2.2e-16


    Box-Ljung test

data:  Squared.Residuals
X-squared = 2.6384, df = 1, p-value = 0.1043</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(garch_returns_exxon1)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals
Q* = 780.1, df = 730.5, p-value = 0.0991

Model df: 0.   Total lags used: 730.5</code></pre>
</div>
</div>
<p>The estimated GARCH(1,1) model coefficients are statistically significant.</p>
<p>The p-value from the Ljung-Box test suggests that there’s no significant autocorrelation in the residuals.</p>
</section>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<section id="method-1-arima001-garch11" class="level3">
<h3 class="anchored" data-anchor-id="method-1-arima001-garch11">Method 1: ARIMA(0,0,1) + GARCH(1,1)</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_chevron)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Series: returns_chevron 
ARIMA(0,0,1) with non-zero mean 

Coefficients:
          ma1   mean
      -0.0768  4e-04
s.e.   0.0109  2e-04

sigma^2 = 0.0002714:  log likelihood = 23243.95
AIC=-46481.9   AICc=-46481.9   BIC=-46460.71

Training set error measures:
                       ME       RMSE        MAE MPE MAPE      MASE         ACF1
Training set 2.755876e-08 0.01647188 0.01143922 NaN  Inf 0.6711245 0.0009039099</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>garch_chevron <span class="ot">&lt;-</span> <span class="fu">garchFit</span>(<span class="sc">~</span><span class="fu">garch</span>(<span class="dv">1</span>,<span class="dv">1</span>), chevron.res,<span class="at">trace =</span> F)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(garch_chevron)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Title:
 GARCH Modelling 

Call:
 garchFit(formula = ~garch(1, 1), data = chevron.res, trace = F) 

Mean and Variance Equation:
 data ~ garch(1, 1)
&lt;environment: 0x14c3f8000&gt;
 [data = chevron.res]

Conditional Distribution:
 norm 

Coefficient(s):
        mu       omega      alpha1       beta1  
2.7593e-08  3.9797e-06  7.0278e-02  9.1320e-01  

Std. Errors:
 based on Hessian 

Error Analysis:
        Estimate  Std. Error  t value Pr(&gt;|t|)    
mu     2.759e-08   1.393e-04    0.000        1    
omega  3.980e-06   5.763e-07    6.906 4.99e-12 ***
alpha1 7.028e-02   5.251e-03   13.383  &lt; 2e-16 ***
beta1  9.132e-01   6.499e-03  140.515  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Log Likelihood:
 24545.54    normalized:  2.837635 

Description:
 Sun May  5 18:33:18 2024 by user:  


Standardised Residuals Tests:
                                Statistic p-Value     
 Jarque-Bera Test   R    Chi^2  983.1367  0           
 Shapiro-Wilk Test  R    W      NA        NA          
 Ljung-Box Test     R    Q(10)  35.10628  0.0001197562
 Ljung-Box Test     R    Q(15)  38.88622  0.0006664173
 Ljung-Box Test     R    Q(20)  50.08895  0.0002150749
 Ljung-Box Test     R^2  Q(10)  18.63892  0.04509597  
 Ljung-Box Test     R^2  Q(15)  19.8402   0.178149    
 Ljung-Box Test     R^2  Q(20)  26.67559  0.1446401   
 LM Arch Test       R    TR^2   18.72892  0.09528387  

Information Criterion Statistics:
      AIC       BIC       SIC      HQIC 
-5.674345 -5.671077 -5.674345 -5.673231 </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">garch</span>(chevron.res, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">trace =</span> F))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
garch(x = chevron.res, order = c(1, 1), trace = F)

Model:
GARCH(1,1)

Residuals:
     Min       1Q   Median       3Q      Max 
-7.32833 -0.60014  0.01376  0.61839  5.71027 

Coefficient(s):
    Estimate  Std. Error  t value Pr(&gt;|t|)    
a0 3.980e-06   4.051e-07    9.826   &lt;2e-16 ***
a1 7.028e-02   3.258e-03   21.570   &lt;2e-16 ***
b1 9.132e-01   4.318e-03  211.478   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Diagnostic Tests:
    Jarque Bera Test

data:  Residuals
X-squared = 983.62, df = 2, p-value &lt; 2.2e-16


    Box-Ljung test

data:  Squared.Residuals
X-squared = 0.25204, df = 1, p-value = 0.6156</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(<span class="fu">garch</span>(chevron.res, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">trace =</span> F))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals
Q* = 778.07, df = 730.5, p-value = 0.1082

Model df: 0.   Total lags used: 730.5</code></pre>
</div>
</div>
<p>The residuals do not show any obvious trends or seasonality, which suggests that the ARIMA model has captured the linear structure of the data.</p>
<p>The Ljung-Box test on residuals with a p-value of 0.1156 suggests that there is no significant autocorrelation in the residuals. This implies that the model residuals are random.</p>
<p>The coefficients of the GARCH(1,1) model are all statistically significant.</p>
<p>The diagnostic checks on the ARIMA(0,0,1) + GARCH(1,1) model reveal that the residuals do not show significant trends or seasonality. The GARCH model’s significant coefficients for omega, alpha, and beta confirm its efficacy in capturing the stock’s volatility clustering. The absence of autocorrelation in the residuals post-modelling further validates the model fit.</p>
</section>
<section id="method-2-garch11-1" class="level3">
<h3 class="anchored" data-anchor-id="method-2-garch11-1">Method 2: GARCH(1,1)</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>garch_returns_chevron1 <span class="ot">&lt;-</span> <span class="fu">garch</span>(returns_chevron, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">trace =</span> F)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(garch_returns_chevron1)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
garch(x = returns_chevron, order = c(1, 1), trace = F)

Model:
GARCH(1,1)

Residuals:
     Min       1Q   Median       3Q      Max 
-7.36074 -0.57404  0.03129  0.64922  5.80472 

Coefficient(s):
    Estimate  Std. Error  t value Pr(&gt;|t|)    
a0 3.889e-06   4.009e-07    9.701   &lt;2e-16 ***
a1 6.923e-02   3.175e-03   21.805   &lt;2e-16 ***
b1 9.146e-01   4.226e-03  216.401   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Diagnostic Tests:
    Jarque Bera Test

data:  Residuals
X-squared = 1006.9, df = 2, p-value &lt; 2.2e-16


    Box-Ljung test

data:  Squared.Residuals
X-squared = 0.017441, df = 1, p-value = 0.8949</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(garch_returns_chevron1)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals
Q* = 742.3, df = 730.5, p-value = 0.3728

Model df: 0.   Total lags used: 730.5</code></pre>
</div>
</div>
<p>The estimated GARCH(1,1) model coefficients are statistically significant.</p>
<p>The p-value from the Ljung-Box test suggests that there’s no significant autocorrelation in the residuals.</p>
</section>
</div>
</div>
</div>
</section>
<section id="cross-validation" class="level1">
<h1>11. Cross-Validation</h1>
<p>Cross-validation is an essential technique in model validation, which helps to ensure that the results of our time series analysis generalize to independent data sets. Now lets do cross-validation, I have employed a rolling forecasting methodology to to validate both the models selected above.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">Exxon Mobil</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">Chevron Corporation</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">900</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(returns_exxon)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>err1 <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>err2 <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n<span class="sc">-</span>k)) {</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>  xtrain <span class="ot">&lt;-</span> returns_exxon[<span class="dv">1</span><span class="sc">:</span>(k<span class="dv">-1</span>)<span class="sc">+</span>i]</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>  xtest <span class="ot">&lt;-</span> returns_exxon[k<span class="sc">+</span>i]</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ARIMA(1,0,1) + GARCH(1,1)</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>  arima.fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(xtrain, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">include.drift =</span> <span class="cn">TRUE</span>)</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>  arima.res <span class="ot">&lt;-</span> <span class="fu">residuals</span>(arima.fit)</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>  fit1 <span class="ot">&lt;-</span> <span class="fu">garchFit</span>(<span class="sc">~</span><span class="fu">garch</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">data =</span> arima.res, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>  fcast1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit1, <span class="at">n.ahead =</span> <span class="dv">1</span>)</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># GARCH(1,1)</span></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>  returns_diff <span class="ot">&lt;-</span> <span class="fu">diff</span>(xtrain)  </span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>  fit2 <span class="ot">&lt;-</span> <span class="fu">garchFit</span>(<span class="sc">~</span><span class="fu">garch</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">data =</span> xtrain, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>  fcast2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit2, <span class="at">n.ahead =</span> <span class="dv">1</span>)</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>  err1 <span class="ot">&lt;-</span> <span class="fu">c</span>(err1, (fcast1<span class="sc">$</span>meanForecast <span class="sc">-</span> xtest)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>  err2 <span class="ot">&lt;-</span> <span class="fu">c</span>(err2, (fcast2<span class="sc">$</span>meanForecast <span class="sc">-</span> xtest)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a>RMSE1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(err1))</span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a>RMSE2 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(err2))</span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"The RMSE for model 1 -"</span>, RMSE1, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The RMSE for model 1 - 0.01608459 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"The RMSE for model 2 -"</span>, RMSE2, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The RMSE for model 2 - 0.01608721 </code></pre>
</div>
</div>
<p>After performing cross-validation, we can see that Model 1 had slighlty lowest RMSE. Therefore, the best model according to diagnostics is Model 1: ARIMA(1,0,1) + GARCH(1,1)</p>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">900</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(returns_chevron)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>err1 <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>err2 <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n<span class="sc">-</span>k)) {</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>  xtrain <span class="ot">&lt;-</span> returns_chevron[<span class="dv">1</span><span class="sc">:</span>(k<span class="dv">-1</span>)<span class="sc">+</span>i]</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>  xtest <span class="ot">&lt;-</span> returns_chevron[k<span class="sc">+</span>i]</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ARIMA(0,0,1) + GARCH(1,1)</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>  arima.fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(xtrain, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">include.drift =</span> <span class="cn">TRUE</span>)</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>  arima.res <span class="ot">&lt;-</span> <span class="fu">residuals</span>(arima.fit)</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>  fit1 <span class="ot">&lt;-</span> <span class="fu">garchFit</span>(<span class="sc">~</span><span class="fu">garch</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">data =</span> arima.res, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>  fcast1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit1, <span class="at">n.ahead =</span> <span class="dv">1</span>)</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># GARCH(1,1)</span></span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>  returns_diff <span class="ot">&lt;-</span> <span class="fu">diff</span>(xtrain)  </span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>  fit2 <span class="ot">&lt;-</span> <span class="fu">garchFit</span>(<span class="sc">~</span><span class="fu">garch</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">data =</span> xtrain, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>  fcast2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit2, <span class="at">n.ahead =</span> <span class="dv">1</span>)</span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>  err1 <span class="ot">&lt;-</span> <span class="fu">c</span>(err1, (fcast1<span class="sc">$</span>meanForecast <span class="sc">-</span> xtest)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a>  err2 <span class="ot">&lt;-</span> <span class="fu">c</span>(err2, (fcast2<span class="sc">$</span>meanForecast <span class="sc">-</span> xtest)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a>RMSE1_c <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(err1))</span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a>RMSE2_c <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(err2))</span></code></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"The RMSE for model 1 -"</span>, RMSE1_c, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The RMSE for model 1 - 0.01696804 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"The RMSE for model 2 -"</span>, RMSE2_c, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The RMSE for model 2 - 0.01697228 </code></pre>
</div>
</div>
<p>After performing cross-validation, we can see both models perform comparablybut Model 1 had slighlty lowest RMSE. Therefore, the best model according to diagnostics is Model 1: ARIMA(0,0,1) + GARCH(1,1)</p>
</div>
</div>
</div>
</section>
<section id="final-model" class="level1">
<h1>12. Final Model</h1>
<p>Now I will fit the model with best performance</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">Exxon Mobil</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">Chevron Corporation</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Fit the ARIMA model</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>arima_exxon_final <span class="ot">&lt;-</span> <span class="fu">Arima</span>(returns_exxon, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Extract the residuals</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>residuals_exxon_final <span class="ot">&lt;-</span> <span class="fu">residuals</span>(arima_exxon_final)</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the GARCH model on the residuals</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>garch_exxon_final <span class="ot">&lt;-</span> <span class="fu">garchFit</span>(<span class="sc">~</span><span class="fu">garch</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">data =</span> residuals_exxon_final, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(garch_exxon_final)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Title:
 GARCH Modelling 

Call:
 garchFit(formula = ~garch(1, 1), data = residuals_exxon_final, 
    trace = FALSE) 

Mean and Variance Equation:
 data ~ garch(1, 1)
&lt;environment: 0x10bc863c8&gt;
 [data = residuals_exxon_final]

Conditional Distribution:
 norm 

Coefficient(s):
        mu       omega      alpha1       beta1  
2.5993e-05  2.4488e-06  7.0824e-02  9.1892e-01  

Std. Errors:
 based on Hessian 

Error Analysis:
        Estimate  Std. Error  t value Pr(&gt;|t|)    
mu     2.599e-05   1.289e-04    0.202     0.84    
omega  2.449e-06   3.988e-07    6.141 8.21e-10 ***
alpha1 7.082e-02   5.375e-03   13.176  &lt; 2e-16 ***
beta1  9.189e-01   6.108e-03  150.444  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Log Likelihood:
 25012.55    normalized:  2.891624 

Description:
 Sun May  5 18:45:32 2024 by user:  


Standardised Residuals Tests:
                                Statistic p-Value   
 Jarque-Bera Test   R    Chi^2  662.9813  0         
 Shapiro-Wilk Test  R    W      NA        NA        
 Ljung-Box Test     R    Q(10)  19.93908  0.02983422
 Ljung-Box Test     R    Q(15)  22.27227  0.1008611 
 Ljung-Box Test     R    Q(20)  32.00702  0.0432236 
 Ljung-Box Test     R^2  Q(10)  21.06936  0.02061506
 Ljung-Box Test     R^2  Q(15)  28.53337  0.01845906
 Ljung-Box Test     R^2  Q(20)  30.91429  0.05633217
 LM Arch Test       R    TR^2   24.28011  0.01862777

Information Criterion Statistics:
      AIC       BIC       SIC      HQIC 
-5.782324 -5.779056 -5.782324 -5.781210 </code></pre>
</div>
</div>
<ul>
<li>All the coefficients are significant</li>
<li>The log likelihood of the model is 24997.66, suggesting a very good fit to the data.</li>
<li>The information criteria values (AIC, BIC, SIC, HQIC) are extremely low.</li>
<li>Ljung-Box Tests on Residuals and Squared Residuals: These indicate some autocorrelation in residuals</li>
</ul>
<p>The ARIMA(1,0,1) + GARCH(1,1) effectively captures the volatility dynamics in Exxon Mobil’s stock returns.</p>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Fit the ARIMA model</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>arima_chevron_final <span class="ot">&lt;-</span> <span class="fu">Arima</span>(returns_chevron, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Extract the residuals</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>residuals_chevron_final <span class="ot">&lt;-</span> <span class="fu">residuals</span>(arima_chevron_final)</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the GARCH model on the residuals</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>garch_chevron_final <span class="ot">&lt;-</span> <span class="fu">garchFit</span>(<span class="sc">~</span><span class="fu">garch</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">data =</span> residuals_chevron_final, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(garch_chevron_final)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Title:
 GARCH Modelling 

Call:
 garchFit(formula = ~garch(1, 1), data = residuals_chevron_final, 
    trace = FALSE) 

Mean and Variance Equation:
 data ~ garch(1, 1)
&lt;environment: 0x1044163d8&gt;
 [data = residuals_chevron_final]

Conditional Distribution:
 norm 

Coefficient(s):
        mu       omega      alpha1       beta1  
2.7593e-08  3.9797e-06  7.0278e-02  9.1320e-01  

Std. Errors:
 based on Hessian 

Error Analysis:
        Estimate  Std. Error  t value Pr(&gt;|t|)    
mu     2.759e-08   1.393e-04    0.000        1    
omega  3.980e-06   5.763e-07    6.906 4.99e-12 ***
alpha1 7.028e-02   5.251e-03   13.383  &lt; 2e-16 ***
beta1  9.132e-01   6.499e-03  140.515  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Log Likelihood:
 24545.54    normalized:  2.837635 

Description:
 Sun May  5 18:45:32 2024 by user:  


Standardised Residuals Tests:
                                Statistic p-Value     
 Jarque-Bera Test   R    Chi^2  983.1367  0           
 Shapiro-Wilk Test  R    W      NA        NA          
 Ljung-Box Test     R    Q(10)  35.10628  0.0001197562
 Ljung-Box Test     R    Q(15)  38.88622  0.0006664173
 Ljung-Box Test     R    Q(20)  50.08895  0.0002150749
 Ljung-Box Test     R^2  Q(10)  18.63892  0.04509597  
 Ljung-Box Test     R^2  Q(15)  19.8402   0.178149    
 Ljung-Box Test     R^2  Q(20)  26.67559  0.1446401   
 LM Arch Test       R    TR^2   18.72892  0.09528387  

Information Criterion Statistics:
      AIC       BIC       SIC      HQIC 
-5.674345 -5.671077 -5.674345 -5.673231 </code></pre>
</div>
</div>
<ul>
<li>All the coefficients are significant</li>
<li>The log likelihood of the model is 24533.25, suggesting a very good fit to the data.</li>
<li>Ljung-Box Tests on Residuals and Squared Residuals:
<ul>
<li>For Residuals: The low p-values in earlier lags suggest significant autocorrelation</li>
<li>For Squared Residuals: The higher p-values in the squared residuals suggest less evidence of autocorrelation in the volatility</li>
</ul></li>
</ul>
<p>The ARIMA(0,0,1) + GARCH(1,1) effectively captures the volatility dynamics as evidenced by the significant coefficients for all model parameters.</p>
</div>
</div>
</div>
</section>
<section id="forecasting-with-the-final-model" class="level1">
<h1>13. Forecasting with the Final Model</h1>
<p>Now I would use the final model to forecast the future trends</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">Exxon Mobil</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">Chevron Corporation</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(garch_exxon_final, <span class="at">n.ahead =</span> <span class="dv">100</span>, <span class="at">plot =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>    meanForecast  meanError standardDeviation lowerInterval upperInterval
1   2.599336e-05 0.01179791        0.01179791   -0.02309749    0.02314948
2   2.599336e-05 0.01184112        0.01184112   -0.02318217    0.02323416
3   2.599336e-05 0.01188372        0.01188372   -0.02326568    0.02331767
4   2.599336e-05 0.01192574        0.01192574   -0.02334804    0.02340002
5   2.599336e-05 0.01196719        0.01196719   -0.02342926    0.02348125
6   2.599336e-05 0.01200807        0.01200807   -0.02350938    0.02356137
7   2.599336e-05 0.01204839        0.01204839   -0.02358841    0.02364040
8   2.599336e-05 0.01208816        0.01208816   -0.02366637    0.02371836
9   2.599336e-05 0.01212740        0.01212740   -0.02374328    0.02379527
10  2.599336e-05 0.01216612        0.01216612   -0.02381916    0.02387114
11  2.599336e-05 0.01220431        0.01220431   -0.02389402    0.02394600
12  2.599336e-05 0.01224200        0.01224200   -0.02396788    0.02401987
13  2.599336e-05 0.01227918        0.01227918   -0.02404076    0.02409275
14  2.599336e-05 0.01231588        0.01231588   -0.02411268    0.02416467
15  2.599336e-05 0.01235208        0.01235208   -0.02418365    0.02423563
16  2.599336e-05 0.01238782        0.01238782   -0.02425369    0.02430567
17  2.599336e-05 0.01242309        0.01242309   -0.02432281    0.02437479
18  2.599336e-05 0.01245789        0.01245789   -0.02439103    0.02444301
19  2.599336e-05 0.01249225        0.01249225   -0.02445836    0.02451035
20  2.599336e-05 0.01252615        0.01252615   -0.02452482    0.02457681
21  2.599336e-05 0.01255963        0.01255963   -0.02459042    0.02464241
22  2.599336e-05 0.01259267        0.01259267   -0.02465518    0.02470717
23  2.599336e-05 0.01262528        0.01262528   -0.02471911    0.02477109
24  2.599336e-05 0.01265748        0.01265748   -0.02478221    0.02483420
25  2.599336e-05 0.01268927        0.01268927   -0.02484452    0.02489650
26  2.599336e-05 0.01272065        0.01272065   -0.02490603    0.02495802
27  2.599336e-05 0.01275164        0.01275164   -0.02496676    0.02501875
28  2.599336e-05 0.01278223        0.01278223   -0.02502672    0.02507871
29  2.599336e-05 0.01281244        0.01281244   -0.02508593    0.02513792
30  2.599336e-05 0.01284227        0.01284227   -0.02514440    0.02519638
31  2.599336e-05 0.01287173        0.01287173   -0.02520213    0.02525411
32  2.599336e-05 0.01290081        0.01290081   -0.02525914    0.02531112
33  2.599336e-05 0.01292954        0.01292954   -0.02531543    0.02536742
34  2.599336e-05 0.01295790        0.01295790   -0.02537103    0.02542302
35  2.599336e-05 0.01298592        0.01298592   -0.02542594    0.02547792
36  2.599336e-05 0.01301359        0.01301359   -0.02548017    0.02553215
37  2.599336e-05 0.01304091        0.01304091   -0.02553373    0.02558571
38  2.599336e-05 0.01306790        0.01306790   -0.02558662    0.02563861
39  2.599336e-05 0.01309456        0.01309456   -0.02563887    0.02569086
40  2.599336e-05 0.01312089        0.01312089   -0.02569048    0.02574247
41  2.599336e-05 0.01314690        0.01314690   -0.02574146    0.02579345
42  2.599336e-05 0.01317259        0.01317259   -0.02579182    0.02584380
43  2.599336e-05 0.01319797        0.01319797   -0.02584156    0.02589355
44  2.599336e-05 0.01322304        0.01322304   -0.02589070    0.02594269
45  2.599336e-05 0.01324781        0.01324781   -0.02593924    0.02599123
46  2.599336e-05 0.01327228        0.01327228   -0.02598720    0.02603918
47  2.599336e-05 0.01329645        0.01329645   -0.02603458    0.02608656
48  2.599336e-05 0.01332033        0.01332033   -0.02608138    0.02613337
49  2.599336e-05 0.01334393        0.01334393   -0.02612763    0.02617961
50  2.599336e-05 0.01336724        0.01336724   -0.02617332    0.02622530
51  2.599336e-05 0.01339027        0.01339027   -0.02621846    0.02627045
52  2.599336e-05 0.01341303        0.01341303   -0.02626306    0.02631505
53  2.599336e-05 0.01343552        0.01343552   -0.02630714    0.02635912
54  2.599336e-05 0.01345774        0.01345774   -0.02635068    0.02640267
55  2.599336e-05 0.01347969        0.01347969   -0.02639371    0.02644570
56  2.599336e-05 0.01350138        0.01350138   -0.02643623    0.02648822
57  2.599336e-05 0.01352282        0.01352282   -0.02647825    0.02653024
58  2.599336e-05 0.01354401        0.01354401   -0.02651977    0.02657176
59  2.599336e-05 0.01356494        0.01356494   -0.02656080    0.02661279
60  2.599336e-05 0.01358563        0.01358563   -0.02660135    0.02665333
61  2.599336e-05 0.01360607        0.01360607   -0.02664142    0.02669341
62  2.599336e-05 0.01362628        0.01362628   -0.02668102    0.02673301
63  2.599336e-05 0.01364625        0.01364625   -0.02672016    0.02677214
64  2.599336e-05 0.01366598        0.01366598   -0.02675884    0.02681082
65  2.599336e-05 0.01368548        0.01368548   -0.02679706    0.02684905
66  2.599336e-05 0.01370476        0.01370476   -0.02683485    0.02688683
67  2.599336e-05 0.01372381        0.01372381   -0.02687219    0.02692418
68  2.599336e-05 0.01374265        0.01374265   -0.02690910    0.02696108
69  2.599336e-05 0.01376126        0.01376126   -0.02694558    0.02699756
70  2.599336e-05 0.01377966        0.01377966   -0.02698163    0.02703362
71  2.599336e-05 0.01379784        0.01379784   -0.02701728    0.02706926
72  2.599336e-05 0.01381581        0.01381581   -0.02705250    0.02710449
73  2.599336e-05 0.01383358        0.01383358   -0.02708733    0.02713931
74  2.599336e-05 0.01385114        0.01385114   -0.02712175    0.02717373
75  2.599336e-05 0.01386850        0.01386850   -0.02715577    0.02720776
76  2.599336e-05 0.01388566        0.01388566   -0.02718941    0.02724139
77  2.599336e-05 0.01390263        0.01390263   -0.02722266    0.02727464
78  2.599336e-05 0.01391940        0.01391940   -0.02725552    0.02730751
79  2.599336e-05 0.01393597        0.01393597   -0.02728802    0.02734000
80  2.599336e-05 0.01395236        0.01395236   -0.02732014    0.02737212
81  2.599336e-05 0.01396856        0.01396856   -0.02735189    0.02740388
82  2.599336e-05 0.01398458        0.01398458   -0.02738328    0.02743527
83  2.599336e-05 0.01400042        0.01400042   -0.02741432    0.02746630
84  2.599336e-05 0.01401607        0.01401607   -0.02744500    0.02749699
85  2.599336e-05 0.01403155        0.01403155   -0.02747533    0.02752732
86  2.599336e-05 0.01404685        0.01404685   -0.02750532    0.02755731
87  2.599336e-05 0.01406198        0.01406198   -0.02753497    0.02758696
88  2.599336e-05 0.01407693        0.01407693   -0.02756429    0.02761627
89  2.599336e-05 0.01409172        0.01409172   -0.02759327    0.02764526
90  2.599336e-05 0.01410634        0.01410634   -0.02762193    0.02767391
91  2.599336e-05 0.01412080        0.01412080   -0.02765026    0.02770224
92  2.599336e-05 0.01413509        0.01413509   -0.02767827    0.02773026
93  2.599336e-05 0.01414922        0.01414922   -0.02770597    0.02775796
94  2.599336e-05 0.01416319        0.01416319   -0.02773336    0.02778534
95  2.599336e-05 0.01417701        0.01417701   -0.02776044    0.02781242
96  2.599336e-05 0.01419067        0.01419067   -0.02778721    0.02783920
97  2.599336e-05 0.01420418        0.01420418   -0.02781369    0.02786568
98  2.599336e-05 0.01421754        0.01421754   -0.02783987    0.02789186
99  2.599336e-05 0.01423075        0.01423075   -0.02786576    0.02791774
100 2.599336e-05 0.01424381        0.01424381   -0.02789136    0.02794334</code></pre>
</div>
</div>
<p>Future will be similar but with higher uncertainty because of the bigger confidence intervals.</p>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(garch_chevron_final, <span class="at">n.ahead =</span> <span class="dv">100</span>, <span class="at">plot =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>    meanForecast  meanError standardDeviation lowerInterval upperInterval
1   2.759292e-08 0.01226980        0.01226980   -0.02404835    0.02404840
2   2.759292e-08 0.01233045        0.01233045   -0.02416722    0.02416727
3   2.759292e-08 0.01238981        0.01238981   -0.02428356    0.02428361
4   2.759292e-08 0.01244791        0.01244791   -0.02439743    0.02439749
5   2.759292e-08 0.01250479        0.01250479   -0.02450891    0.02450897
6   2.759292e-08 0.01256048        0.01256048   -0.02461806    0.02461811
7   2.759292e-08 0.01261501        0.01261501   -0.02472493    0.02472498
8   2.759292e-08 0.01266840        0.01266840   -0.02482958    0.02482964
9   2.759292e-08 0.01272070        0.01272070   -0.02493208    0.02493214
10  2.759292e-08 0.01277192        0.01277192   -0.02503248    0.02503253
11  2.759292e-08 0.01282210        0.01282210   -0.02513082    0.02513088
12  2.759292e-08 0.01287126        0.01287126   -0.02522717    0.02522722
13  2.759292e-08 0.01291942        0.01291942   -0.02532157    0.02532162
14  2.759292e-08 0.01296661        0.01296661   -0.02541406    0.02541412
15  2.759292e-08 0.01301286        0.01301286   -0.02550470    0.02550475
16  2.759292e-08 0.01305818        0.01305818   -0.02559353    0.02559358
17  2.759292e-08 0.01310260        0.01310260   -0.02568059    0.02568064
18  2.759292e-08 0.01314614        0.01314614   -0.02576592    0.02576598
19  2.759292e-08 0.01318881        0.01318881   -0.02584957    0.02584963
20  2.759292e-08 0.01323065        0.01323065   -0.02593158    0.02593163
21  2.759292e-08 0.01327167        0.01327167   -0.02601198    0.02601203
22  2.759292e-08 0.01331189        0.01331189   -0.02609080    0.02609086
23  2.759292e-08 0.01335133        0.01335133   -0.02616810    0.02616815
24  2.759292e-08 0.01339000        0.01339000   -0.02624389    0.02624395
25  2.759292e-08 0.01342792        0.01342792   -0.02631822    0.02631827
26  2.759292e-08 0.01346512        0.01346512   -0.02639112    0.02639117
27  2.759292e-08 0.01350159        0.01350159   -0.02646261    0.02646267
28  2.759292e-08 0.01353737        0.01353737   -0.02653274    0.02653279
29  2.759292e-08 0.01357247        0.01357247   -0.02660153    0.02660158
30  2.759292e-08 0.01360690        0.01360690   -0.02666900    0.02666906
31  2.759292e-08 0.01364067        0.01364067   -0.02673520    0.02673525
32  2.759292e-08 0.01367381        0.01367381   -0.02680014    0.02680020
33  2.759292e-08 0.01370632        0.01370632   -0.02686386    0.02686391
34  2.759292e-08 0.01373821        0.01373821   -0.02692638    0.02692643
35  2.759292e-08 0.01376951        0.01376951   -0.02698772    0.02698777
36  2.759292e-08 0.01380022        0.01380022   -0.02704791    0.02704797
37  2.759292e-08 0.01383036        0.01383036   -0.02710698    0.02710704
38  2.759292e-08 0.01385994        0.01385994   -0.02716495    0.02716500
39  2.759292e-08 0.01388896        0.01388896   -0.02722184    0.02722189
40  2.759292e-08 0.01391745        0.01391745   -0.02727767    0.02727772
41  2.759292e-08 0.01394541        0.01394541   -0.02733247    0.02733252
42  2.759292e-08 0.01397285        0.01397285   -0.02738625    0.02738631
43  2.759292e-08 0.01399979        0.01399979   -0.02743905    0.02743910
44  2.759292e-08 0.01402623        0.01402623   -0.02749087    0.02749093
45  2.759292e-08 0.01405218        0.01405218   -0.02754174    0.02754180
46  2.759292e-08 0.01407766        0.01407766   -0.02759168    0.02759174
47  2.759292e-08 0.01410268        0.01410268   -0.02764071    0.02764077
48  2.759292e-08 0.01412723        0.01412723   -0.02768884    0.02768890
49  2.759292e-08 0.01415134        0.01415134   -0.02773610    0.02773615
50  2.759292e-08 0.01417502        0.01417502   -0.02778249    0.02778255
51  2.759292e-08 0.01419826        0.01419826   -0.02782805    0.02782810
52  2.759292e-08 0.01422108        0.01422108   -0.02787278    0.02787283
53  2.759292e-08 0.01424349        0.01424349   -0.02791670    0.02791675
54  2.759292e-08 0.01426549        0.01426549   -0.02795982    0.02795988
55  2.759292e-08 0.01428710        0.01428710   -0.02800217    0.02800223
56  2.759292e-08 0.01430832        0.01430832   -0.02804376    0.02804381
57  2.759292e-08 0.01432915        0.01432915   -0.02808460    0.02808465
58  2.759292e-08 0.01434962        0.01434962   -0.02812471    0.02812476
59  2.759292e-08 0.01436971        0.01436971   -0.02816409    0.02816415
60  2.759292e-08 0.01438945        0.01438945   -0.02820278    0.02820283
61  2.759292e-08 0.01440884        0.01440884   -0.02824077    0.02824083
62  2.759292e-08 0.01442787        0.01442787   -0.02827809    0.02827814
63  2.759292e-08 0.01444657        0.01444657   -0.02831474    0.02831479
64  2.759292e-08 0.01446494        0.01446494   -0.02835074    0.02835079
65  2.759292e-08 0.01448298        0.01448298   -0.02838609    0.02838615
66  2.759292e-08 0.01450070        0.01450070   -0.02842083    0.02842088
67  2.759292e-08 0.01451811        0.01451811   -0.02845494    0.02845500
68  2.759292e-08 0.01453521        0.01453521   -0.02848846    0.02848851
69  2.759292e-08 0.01455201        0.01455201   -0.02852138    0.02852143
70  2.759292e-08 0.01456851        0.01456851   -0.02855372    0.02855377
71  2.759292e-08 0.01458472        0.01458472   -0.02858549    0.02858554
72  2.759292e-08 0.01460064        0.01460064   -0.02861670    0.02861676
73  2.759292e-08 0.01461628        0.01461628   -0.02864736    0.02864742
74  2.759292e-08 0.01463165        0.01463165   -0.02867749    0.02867754
75  2.759292e-08 0.01464675        0.01464675   -0.02870708    0.02870713
76  2.759292e-08 0.01466159        0.01466159   -0.02873616    0.02873621
77  2.759292e-08 0.01467616        0.01467616   -0.02876472    0.02876478
78  2.759292e-08 0.01469048        0.01469048   -0.02879279    0.02879284
79  2.759292e-08 0.01470455        0.01470455   -0.02882037    0.02882042
80  2.759292e-08 0.01471838        0.01471838   -0.02884746    0.02884752
81  2.759292e-08 0.01473196        0.01473196   -0.02887408    0.02887414
82  2.759292e-08 0.01474531        0.01474531   -0.02890024    0.02890030
83  2.759292e-08 0.01475842        0.01475842   -0.02892595    0.02892600
84  2.759292e-08 0.01477131        0.01477131   -0.02895120    0.02895126
85  2.759292e-08 0.01478397        0.01478397   -0.02897602    0.02897608
86  2.759292e-08 0.01479641        0.01479641   -0.02900041    0.02900046
87  2.759292e-08 0.01480864        0.01480864   -0.02902437    0.02902443
88  2.759292e-08 0.01482065        0.01482065   -0.02904792    0.02904797
89  2.759292e-08 0.01483246        0.01483246   -0.02907106    0.02907112
90  2.759292e-08 0.01484406        0.01484406   -0.02909380    0.02909386
91  2.759292e-08 0.01485546        0.01485546   -0.02911615    0.02911620
92  2.759292e-08 0.01486667        0.01486667   -0.02913811    0.02913816
93  2.759292e-08 0.01487768        0.01487768   -0.02915969    0.02915975
94  2.759292e-08 0.01488850        0.01488850   -0.02918090    0.02918096
95  2.759292e-08 0.01489914        0.01489914   -0.02920175    0.02920180
96  2.759292e-08 0.01490959        0.01490959   -0.02922223    0.02922229
97  2.759292e-08 0.01491986        0.01491986   -0.02924237    0.02924242
98  2.759292e-08 0.01492996        0.01492996   -0.02926215    0.02926221
99  2.759292e-08 0.01493988        0.01493988   -0.02928160    0.02928166
100 2.759292e-08 0.01494963        0.01494963   -0.02930071    0.02930077</code></pre>
</div>
</div>
<p>The forecast plot, based on the ARIMA(0,0,1) + GARCH(1,1) model, shows future trends in the volatility of Chevron’s stock returns.</p>
<p>The model anticipates continuity in the return patterns, the forecasted confidence intervals widen, signaling increased uncertainty about future price volatility.</p>
</div>
</div>
</div>
</section>
<section id="volatility-plot" class="level1">
<h1>14. Volatility Plot</h1>
<p>In this section, we will look at the volatility dynamics of stock price as captured by our final model</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">Exxon Mobil</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">Chevron Corporation</a></li></ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>ht <span class="ot">&lt;-</span> garch_exxon_final<span class="sc">@</span>h.t </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>exxon_stockprice_df <span class="ot">=</span> <span class="fu">data.frame</span>(Exxon_stockprice)</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>exxon_stockprice_df <span class="ot">&lt;-</span> <span class="fu">head</span>(exxon_stockprice_df, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>exxon_stockprice_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(exxon_stockprice_df,<span class="fu">rownames</span>(exxon_stockprice_df))</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(exxon_stockprice_df)[<span class="dv">7</span>] <span class="ot">=</span> <span class="st">"date"</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>exxon_stockprice_df<span class="sc">$</span>date<span class="ot">&lt;-</span><span class="fu">as.Date</span>(exxon_stockprice_df<span class="sc">$</span>date,<span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>data_spot <span class="ot">=</span> <span class="fu">data.frame</span>(ht,exxon_stockprice_df<span class="sc">$</span>date)</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_spot, <span class="fu">aes</span>(<span class="at">y =</span> ht, <span class="at">x =</span> exxon_stockprice_df.date)) <span class="sc">+</span> </span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"dodgerblue3"</span>)  <span class="sc">+</span> </span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'Conditional Variance'</span>) <span class="sc">+</span> </span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'Date'</span>) <span class="sc">+</span></span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Volatility plot for Exxon Mobil Stock Price"</span>) <span class="sc">+</span></span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In the graph, we observe periods with peaks indicating heightened volatility, esp around 2008-2009 and then after 2020.</p>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>ht <span class="ot">&lt;-</span> garch_chevron_final<span class="sc">@</span>h.t </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>chevron_stockprice_df <span class="ot">=</span> <span class="fu">data.frame</span>(Chevron_stockprice)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>chevron_stockprice_df <span class="ot">&lt;-</span> <span class="fu">head</span>(chevron_stockprice_df, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>chevron_stockprice_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(chevron_stockprice_df,<span class="fu">rownames</span>(chevron_stockprice_df))</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(chevron_stockprice_df)[<span class="dv">7</span>] <span class="ot">=</span> <span class="st">"date"</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>chevron_stockprice_df<span class="sc">$</span>date<span class="ot">&lt;-</span><span class="fu">as.Date</span>(chevron_stockprice_df<span class="sc">$</span>date,<span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>data_spot <span class="ot">=</span> <span class="fu">data.frame</span>(ht,chevron_stockprice_df<span class="sc">$</span>date)</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_spot, <span class="fu">aes</span>(<span class="at">y =</span> ht, <span class="at">x =</span> chevron_stockprice_df.date)) <span class="sc">+</span></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"dodgerblue3"</span>) <span class="sc">+</span></span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'Conditional Variance'</span>) <span class="sc">+</span></span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'Date'</span>) <span class="sc">+</span></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Volatility plot for Chevron Corporation Stock Price"</span>) <span class="sc">+</span></span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="financial-ts-models_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In the graph, we observe periods with peaks indicating heightened volatility, esp around 2008-2009 and a significant spike after 2020.</p>
</div>
</div>
</div>
</section>
<section id="model-equations" class="level1">
<h1>15. Model Equations</h1>
<p>Finally the model equation based on the best model</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">Exxon Mobil</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false">Chevron Corporation</a></li></ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<p>The best performing model was ARIMA(1,0,1) + GARCH(1,1). The model equation is as follows:</p>
<p><strong>ARIMA(1,0,1)</strong> equation:</p>
<p><span class="math display">\[
(1 - \phi_{B})Y_{t} = (1 + \phi_{B})\epsilon_{t}
\]</span></p>
<p><strong>GARCH(1,1)</strong> equation:</p>
<p><span class="math display">\[
\sigma_{t}^{2} = \alpha_{0} + \alpha_{1}\epsilon^{2}_{t-1}+\beta_{1}\sigma^{2}_{t-1}
\]</span></p>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<p>The best performing model was ARIMA(0,0,1) + GARCH(1,1). The model equation is as follows:</p>
<p><strong>ARIMA(0,0,1)</strong> equation:</p>
<p><span class="math display">\[
Y_t = \theta_1 \epsilon_{t-1} + \epsilon_t
\]</span></p>
<p><strong>GARCH(1,1)</strong> equation:</p>
<p><span class="math display">\[
\sigma_{t}^{2} = \alpha_{0} + \alpha_{1}\epsilon^{2}_{t-1}+\beta_{1}\sigma^{2}_{t-1}
\]</span></p>
</div>
</div>
</div>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>