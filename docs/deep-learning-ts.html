<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.548">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Powering Change - Deep Learning for TS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Powering Change</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./introduction.html"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data-sources.html"> 
<span class="menu-text">Data Sources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data-visualization.html"> 
<span class="menu-text">Data Visualization</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./exploratory-data-analysis.html"> 
<span class="menu-text">EDA</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./univariate-ts-models.html"> 
<span class="menu-text">Univariate TS Models (ARIMA/SARIMA)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./multivariate-ts-models.html"> 
<span class="menu-text">Multivariate TS Models (ARIMAX/SARIMAX/VAR)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./financial-ts-models.html"> 
<span class="menu-text">Financial Time Series Models (ARCH/GARCH)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./deep-learning-ts.html" aria-current="page"> 
<span class="menu-text">Deep Learning for TS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./conclusions.qmd"> 
<span class="menu-text">Conclusions</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">1. Introduction</a></li>
  <li><a href="#data-visualization" id="toc-data-visualization" class="nav-link" data-scroll-target="#data-visualization">2. Data Visualization</a>
  <ul class="collapse">
  <li><a href="#crude-oil" id="toc-crude-oil" class="nav-link" data-scroll-target="#crude-oil">Crude Oil</a></li>
  <li><a href="#electricity" id="toc-electricity" class="nav-link" data-scroll-target="#electricity">Electricity</a></li>
  <li><a href="#cpi" id="toc-cpi" class="nav-link" data-scroll-target="#cpi">CPI</a></li>
  <li><a href="#natural-gas" id="toc-natural-gas" class="nav-link" data-scroll-target="#natural-gas">Natural Gas</a></li>
  </ul></li>
  <li><a href="#normalize-the-natural-gas-data" id="toc-normalize-the-natural-gas-data" class="nav-link" data-scroll-target="#normalize-the-natural-gas-data">Normalize the natural gas data</a></li>
  <li><a href="#split-data-into-training-and-testing" id="toc-split-data-into-training-and-testing" class="nav-link" data-scroll-target="#split-data-into-training-and-testing">Split data into training and testing</a></li>
  <li><a href="#print-the-shapes" id="toc-print-the-shapes" class="nav-link" data-scroll-target="#print-the-shapes">Print the shapes</a></li>
  <li><a href="#plot-the-training-and-testing-sets" id="toc-plot-the-training-and-testing-sets" class="nav-link" data-scroll-target="#plot-the-training-and-testing-sets">Plot the training and testing sets</a></li>
  <li><a href="#create-a-data-frame-for-plotting" id="toc-create-a-data-frame-for-plotting" class="nav-link" data-scroll-target="#create-a-data-frame-for-plotting">Create a data frame for plotting</a></li>
  <li><a href="#create-the-stacked-area-plot-using-ggplot2" id="toc-create-the-stacked-area-plot-using-ggplot2" class="nav-link" data-scroll-target="#create-the-stacked-area-plot-using-ggplot2">Create the stacked area plot using ggplot2</a></li>
  <li><a href="#convert-the-plot-to-an-interactive-plotly-plot" id="toc-convert-the-plot-to-an-interactive-plotly-plot" class="nav-link" data-scroll-target="#convert-the-plot-to-an-interactive-plotly-plot">Convert the plot to an interactive plotly plot</a>
  <ul class="collapse">
  <li><a href="#gdp" id="toc-gdp" class="nav-link" data-scroll-target="#gdp">GDP</a></li>
  </ul></li>
  <li><a href="#normalize-the-gdp-data" id="toc-normalize-the-gdp-data" class="nav-link" data-scroll-target="#normalize-the-gdp-data">Normalize the GDP data</a></li>
  <li><a href="#split-data-into-training-and-testing-1" id="toc-split-data-into-training-and-testing-1" class="nav-link" data-scroll-target="#split-data-into-training-and-testing-1">Split data into training and testing</a></li>
  <li><a href="#print-the-shapes-1" id="toc-print-the-shapes-1" class="nav-link" data-scroll-target="#print-the-shapes-1">Print the shapes</a></li>
  <li><a href="#plot-the-training-and-testing-sets-1" id="toc-plot-the-training-and-testing-sets-1" class="nav-link" data-scroll-target="#plot-the-training-and-testing-sets-1">Plot the training and testing sets</a></li>
  <li><a href="#create-a-data-frame-for-plotting-1" id="toc-create-a-data-frame-for-plotting-1" class="nav-link" data-scroll-target="#create-a-data-frame-for-plotting-1">Create a data frame for plotting</a></li>
  <li><a href="#create-the-stacked-area-plot-using-ggplot2-1" id="toc-create-the-stacked-area-plot-using-ggplot2-1" class="nav-link" data-scroll-target="#create-the-stacked-area-plot-using-ggplot2-1">Create the stacked area plot using ggplot2</a></li>
  <li><a href="#convert-the-plot-to-an-interactive-plotly-plot-1" id="toc-convert-the-plot-to-an-interactive-plotly-plot-1" class="nav-link" data-scroll-target="#convert-the-plot-to-an-interactive-plotly-plot-1">Convert the plot to an interactive plotly plot</a></li>
  <li><a href="#mini-batching" id="toc-mini-batching" class="nav-link" data-scroll-target="#mini-batching">4. Mini Batching</a>
  <ul class="collapse">
  <li><a href="#crude-oil-1" id="toc-crude-oil-1" class="nav-link" data-scroll-target="#crude-oil-1">Crude Oil</a></li>
  </ul></li>
  <li><a href="#function-to-create-mini-batches" id="toc-function-to-create-mini-batches" class="nav-link" data-scroll-target="#function-to-create-mini-batches">Function to create mini-batches</a>
  <ul class="collapse">
  <li><a href="#natural-gas-1" id="toc-natural-gas-1" class="nav-link" data-scroll-target="#natural-gas-1">Natural Gas</a></li>
  </ul></li>
  <li><a href="#display-the-shape" id="toc-display-the-shape" class="nav-link" data-scroll-target="#display-the-shape">Display the shape</a>
  <ul class="collapse">
  <li><a href="#gdp-1" id="toc-gdp-1" class="nav-link" data-scroll-target="#gdp-1">GDP</a></li>
  </ul></li>
  <li><a href="#display-the-shape-1" id="toc-display-the-shape-1" class="nav-link" data-scroll-target="#display-the-shape-1">Display the shape</a></li>
  <li><a href="#recurrent-neural-networks-rnns" id="toc-recurrent-neural-networks-rnns" class="nav-link" data-scroll-target="#recurrent-neural-networks-rnns">5. Recurrent Neural Networks (RNNs)</a>
  <ul class="collapse">
  <li><a href="#crude-oil-2" id="toc-crude-oil-2" class="nav-link" data-scroll-target="#crude-oil-2">Crude Oil</a></li>
  <li><a href="#natural-gas-2" id="toc-natural-gas-2" class="nav-link" data-scroll-target="#natural-gas-2">Natural Gas</a></li>
  <li><a href="#gdp-2" id="toc-gdp-2" class="nav-link" data-scroll-target="#gdp-2">GDP</a></li>
  </ul></li>
  <li><a href="#lstm" id="toc-lstm" class="nav-link" data-scroll-target="#lstm">6. LSTM</a>
  <ul class="collapse">
  <li><a href="#crude-oil-3" id="toc-crude-oil-3" class="nav-link" data-scroll-target="#crude-oil-3">Crude Oil</a></li>
  <li><a href="#natural-gas-3" id="toc-natural-gas-3" class="nav-link" data-scroll-target="#natural-gas-3">Natural Gas</a></li>
  <li><a href="#gdp-3" id="toc-gdp-3" class="nav-link" data-scroll-target="#gdp-3">GDP</a></li>
  </ul></li>
  <li><a href="#gru" id="toc-gru" class="nav-link" data-scroll-target="#gru">7. GRU</a>
  <ul class="collapse">
  <li><a href="#crude-oil-4" id="toc-crude-oil-4" class="nav-link" data-scroll-target="#crude-oil-4">Crude Oil</a></li>
  <li><a href="#electricity-1" id="toc-electricity-1" class="nav-link" data-scroll-target="#electricity-1">Electricity</a></li>
  <li><a href="#cpi-1" id="toc-cpi-1" class="nav-link" data-scroll-target="#cpi-1">CPI</a></li>
  <li><a href="#natural-gas-4" id="toc-natural-gas-4" class="nav-link" data-scroll-target="#natural-gas-4">Natural Gas</a></li>
  <li><a href="#gdp-4" id="toc-gdp-4" class="nav-link" data-scroll-target="#gdp-4">GDP</a></li>
  <li><a href="#how-do-the-results-from-the-3-different-ann-models-compare-with-each-other-in-terms-of-accuracy-and-predictive-power" id="toc-how-do-the-results-from-the-3-different-ann-models-compare-with-each-other-in-terms-of-accuracy-and-predictive-power" class="nav-link" data-scroll-target="#how-do-the-results-from-the-3-different-ann-models-compare-with-each-other-in-terms-of-accuracy-and-predictive-power">8.1 How do the results from the 3 different ANN models compare with each other in terms of accuracy and predictive power?</a></li>
  <li><a href="#crude-oil-5" id="toc-crude-oil-5" class="nav-link" data-scroll-target="#crude-oil-5">Crude Oil</a></li>
  <li><a href="#electricity-2" id="toc-electricity-2" class="nav-link" data-scroll-target="#electricity-2">Electricity</a></li>
  <li><a href="#cpi-2" id="toc-cpi-2" class="nav-link" data-scroll-target="#cpi-2">CPI</a></li>
  <li><a href="#natural-gas-5" id="toc-natural-gas-5" class="nav-link" data-scroll-target="#natural-gas-5">Natural Gas</a></li>
  <li><a href="#gdp-5" id="toc-gdp-5" class="nav-link" data-scroll-target="#gdp-5">GDP</a></li>
  <li><a href="#how-far-into-the-future-can-the-deep-learning-model-accurately-predict-the-future" id="toc-how-far-into-the-future-can-the-deep-learning-model-accurately-predict-the-future" class="nav-link" data-scroll-target="#how-far-into-the-future-can-the-deep-learning-model-accurately-predict-the-future">8.3 How far into the future can the deep learning model accurately predict the future?</a></li>
  <li><a href="#crude-oil-6" id="toc-crude-oil-6" class="nav-link" data-scroll-target="#crude-oil-6">Crude Oil</a></li>
  <li><a href="#electricity-3" id="toc-electricity-3" class="nav-link" data-scroll-target="#electricity-3">Electricity</a></li>
  <li><a href="#cpi-3" id="toc-cpi-3" class="nav-link" data-scroll-target="#cpi-3">CPI</a></li>
  <li><a href="#natural-gas-6" id="toc-natural-gas-6" class="nav-link" data-scroll-target="#natural-gas-6">Natural Gas</a></li>
  <li><a href="#gdp-6" id="toc-gdp-6" class="nav-link" data-scroll-target="#gdp-6">GDP</a></li>
  </ul></li>
  <li><a href="#write-a-discussion-paragraph-comparing-your-models-use-rmse-and-forecasts-from-these-sections-with-your-deep-learning-models." id="toc-write-a-discussion-paragraph-comparing-your-models-use-rmse-and-forecasts-from-these-sections-with-your-deep-learning-models." class="nav-link" data-scroll-target="#write-a-discussion-paragraph-comparing-your-models-use-rmse-and-forecasts-from-these-sections-with-your-deep-learning-models.">9. Write a discussion paragraph Comparing your models (use RMSE) and forecasts from these sections with your Deep Learning Models.</a>
  <ul class="collapse">
  <li><a href="#crude-oil-7" id="toc-crude-oil-7" class="nav-link" data-scroll-target="#crude-oil-7">Crude Oil</a></li>
  <li><a href="#electricity-4" id="toc-electricity-4" class="nav-link" data-scroll-target="#electricity-4">Electricity</a></li>
  <li><a href="#cpi-4" id="toc-cpi-4" class="nav-link" data-scroll-target="#cpi-4">CPI</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Deep Learning for TS</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><code>{r, warning=FALSE, message=FALSE, echo=FALSE} #| code-fold: true #| code-summary: 'Importing Libraries' #| warning: false #| output: false library(ggplot2) library(readr) library(tidyverse) library(lubridate) library(forecast) library(tseries) library(plotly) library(gridExtra) library(zoo) library(astsa) library(ggplot2) library(zoo) library(plotly) library(vars) library(dplyr) library(quantmod) library(FinTS) library(gogarch) library(scales) library(reticulate)</code></p>
<p>```{r, warning=FALSE, message=FALSE, echo=FALSE} #| code-fold: true #| code-summary: ‘Importing Libraries’ #| warning: false #| output: false</p>
<p>library(reticulate) use_python(“/Users/madhvimalhotra/myenv/bin/python”, required = TRUE)</p>
<pre><code>

::: {#b9ea4134 .cell execution_count=1}
``` {.python .cell-code}
#!pip install scikit-learn 
#!pip install tensorflow
#!pip install plotly
#!pip install statsmodels 
#!pip install IPython 
#!pip install matplotlib 
#!pip install seaborn 
#!pip install jupyter 
import numpy as np 
import matplotlib.pyplot as plt 
import seaborn as sns 
import pandas as pd 
import plotly.express as px 
import statsmodels.api as sm 
from IPython.display import IFrame
from sklearn.metrics import mean_squared_error, mean_absolute_error, mean_absolute_percentage_error 
from tensorflow import keras 
from tensorflow.keras import layers 
from tensorflow.keras import initializers 
from tensorflow.keras import regularizers 
from keras.layers import Dense, SimpleRNN, LSTM, GRU, Dropout
# Import L1 and L2 regularizers from Python
import tensorflow.keras.regularizers
import tensorflow as tf
from tensorflow.keras.models import Sequential
from tensorflow.keras.optimizers import Adam
from tensorflow.keras import Input
from keras.optimizers import RMSprop

from keras.callbacks import EarlyStopping
from keras.layers import LSTM, Dropout</code></pre>
<p>:::</p>
<p>```{r, warning=FALSE, message=FALSE, echo=FALSE} #| code-fold: true #| code-summary: ‘Read data’ #| warning: false #| output: false</p>
<p>composite_crude_oil_prices &lt;- read.csv(“data/composite_crude_oil_prices.csv”) citygate_gas_prices &lt;- read.csv(“data/citygate_gas_prices.csv”) total_electricity_prices &lt;- read.csv(“data/total_electricity_prices.csv”) gdp_data &lt;- read.csv(“data/gdp_data.csv”) cpi_data &lt;- read.csv(“data/cpi_data.csv”)</p>
<pre><code>
```{r, warning=FALSE, message=FALSE, echo=FALSE}
#| code-fold: true
#| code-summary: 'convert to ts'
#| warning: false
#| output: false


# For Crude Oil
composite_crude_oil_prices$Date &lt;- as.Date(composite_crude_oil_prices$Date)
start_year &lt;- as.numeric(format(min(composite_crude_oil_prices$Date), "%Y"))
start_month &lt;- as.numeric(format(min(composite_crude_oil_prices$Date), "%m"))
composite_crude_oil_ts &lt;- ts(composite_crude_oil_prices$Value, start=c(start_year, start_month), frequency=12)
# Log-transform Value
composite_crude_oil_prices$LOG_Value &lt;- log(composite_crude_oil_prices$Value)
oil_log_ts &lt;- ts(composite_crude_oil_prices$LOG_Value, start=c(start_year, start_month), frequency=12)

# For Natural Gas
citygate_gas_prices$Date &lt;- as.Date(citygate_gas_prices$Date)
start_year_gas &lt;- as.numeric(format(min(citygate_gas_prices$Date), "%Y"))
start_month_gas &lt;- as.numeric(format(min(citygate_gas_prices$Date), "%m"))
citygate_gas_ts &lt;- ts(citygate_gas_prices$Value, start=c(start_year_gas, start_month_gas), frequency=12)
# Log-transform Value
citygate_gas_prices$LOG_Value &lt;- log(citygate_gas_prices$Value)
gas_log_ts &lt;- ts(citygate_gas_prices$LOG_Value, start=c(start_year_gas, start_month_gas), frequency=12)

# For Electricity
total_electricity_prices$Date &lt;- as.Date(total_electricity_prices$Date, format = "%Y-%m-%d")
start_year_elec &lt;- as.numeric(format(min(total_electricity_prices$Date), "%Y"))
start_month_elec &lt;- as.numeric(format(min(total_electricity_prices$Date), "%m"))
total_electricity_ts &lt;- ts(total_electricity_prices$Value, start = c(start_year_elec, start_month_elec), frequency = 12)
# Log-transform Value
total_electricity_prices$LOG_Value &lt;- log(total_electricity_prices$Value)
electricity_log_ts &lt;- ts(total_electricity_prices$LOG_Value, start=c(start_year_elec, start_month_elec), frequency=12)


# For GDP (it's quarterly)
gdp_data$DATE &lt;- as.Date(gdp_data$DATE, format = "%Y-%m-%d")
start_year_gdp &lt;- as.numeric(format(min(gdp_data$DATE), "%Y"))
start_quarter_gdp &lt;- quarter(min(gdp_data$DATE))
# Log-transform GDP
gdp_data$LOG_GDP &lt;- log(gdp_data$GDP)
gdp_log_ts &lt;- ts(gdp_data$LOG_GDP, start=c(start_year_gdp, start_quarter_gdp), frequency=4)


# For CPI (it's monthly)
cpi_data$DATE &lt;- as.Date(cpi_data$DATE, format = "%Y-%m-%d")
start_year_cpi &lt;- as.numeric(format(min(cpi_data$DATE), "%Y"))
start_month_cpi &lt;- as.numeric(format(min(cpi_data$DATE), "%m"))
# Log-transform CPI
cpi_data$LOG_CPI &lt;- log(cpi_data$CPIAUCSL)
cpi_log_ts &lt;- ts(cpi_data$LOG_CPI, start = c(start_year_cpi, start_month_cpi), frequency = 12)
</code></pre>
<section id="introduction" class="level1">
<h1>1. Introduction</h1>
<p>Time series forecasting plays a pivotal role in various domains, including economics, finance, and business operations. Accurately predicting future trends based on historical data can provide valuable insights for decision-making and strategic planning. Traditionally, statistical methods such as Autoregressive Integrated Moving Average (ARIMA) models have been widely employed for time series analysis. However, these conventional approaches often struggle to capture intricate patterns, non-linear relationships, and long-term dependencies present in complex time series data.</p>
<p>In recent years, deep learning techniques have emerged as powerful alternatives, offering new avenues for time series forecasting. Neural networks, with their ability to learn from data and uncover intricate patterns, have shown remarkable potential in handling sequential data and capturing temporal dependencies. This exploration focuses on three prominent deep learning architectures: Recurrent Neural Networks (RNNs), Long Short-Term Memory Networks (LSTMs), and Gated Recurrent Units (GRUs), each designed to tackle the unique challenges of time series data.</p>
<p>The objective of this study is to evaluate the performance of these deep learning models in forecasting [specify the time series data or domain, e.g., energy prices, stock market trends, or sales data]. By leveraging their capability to handle complex non-linear relationships and long-term dependencies, we aim to enhance our forecasting accuracy and extend the predictive horizon compared to traditional methods.</p>
<p>Furthermore, this exploration will provide insights into the relative strengths and weaknesses of each neural network architecture, informing future decisions on selecting the most suitable approach for specific time series forecasting tasks. We will thoroughly analyze and compare the accuracy, predictive power, and generalization capabilities of RNNs, LSTMs, and GRUs, offering a comprehensive understanding of their applicability in the realm of time series analysis.</p>
<p>By embracing deep learning techniques, we strive to push the boundaries of time series forecasting, enabling more informed decision-making and strategic planning across various industries and domains. This study will contribute to the growing body of knowledge in the field, advancing our understanding of the potential and limitations of deep learning for time series analysis.</p>
</section>
<section id="data-visualization" class="level1">
<h1>2. Data Visualization</h1>
<p>To better understand the patterns in our data, we will first visualize it to examine any trends, seasonality, or anomalies. The visualization helps provide insights into how this time series behaves over time.</p>
<p>::: panel-tabset</p>
<section id="crude-oil" class="level2">
<h2 class="anchored" data-anchor-id="crude-oil">Crude Oil</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=FALSE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: false</p>
<p>oil_plot &lt;- ggplot(composite_crude_oil_prices, aes(x = Date, y = Value)) + geom_line(color = “#99494d”) + theme_minimal() + labs(title = “Crude Oil Prices Over Time”, x = “Date”, y = “Crude Oil Prices”)+ theme(plot.title = element_text(hjust = 0.5))</p>
<p>ggplotly(oil_plot)</p>
<pre><code>



## Natural Gas




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Plot Natural Gas Prices'
#| warning: false
#| output: true

#Plotting
ng_plot &lt;- ggplot(citygate_gas_prices, aes(x = Date, y = Value)) +
  geom_line(color = "#99494d") + 
  theme_minimal() + 
  labs(title = "Natural Gas Price Over Time", 
       x = "Date",
       y = "Price (USD)") +
  theme(plot.title = element_text(hjust = 0.5))  

ggplotly(ng_plot)

</code></pre>
</section>
<section id="electricity" class="level2">
<h2 class="anchored" data-anchor-id="electricity">Electricity</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Plot Electricity Prices’ #| warning: false #| output: true</p>
<p>#Plotting with ggplot2 electricity_plot &lt;- ggplot(total_electricity_prices, aes(x = Date, y = Value)) + geom_line(color = “#99494d”) + theme_minimal() + labs(title = “Average Price of Electricity to Ultimate Customers”,<br>
x = “Date”, y = “Price (Cents per Kilowatthour)”) + theme(plot.title = element_text(hjust = 0.5))</p>
<p>ggplotly(electricity_plot)</p>
<pre><code>




## GDP




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Plot GDP'
#| warning: false
#| output: true

#Plotting with ggplot2
gdp_plot &lt;- ggplot(gdp_data, aes(x = DATE, y = GDP)) +
  geom_line(color = "#99494d") + 
  theme_minimal() +
  labs(title = "Gross Domestic Product Over Time",  
       x = "Date",
       y = "GDP (Billion USD)") +
  theme(plot.title = element_text(hjust = 0.5))  

ggplotly(gdp_plot)

</code></pre>
</section>
<section id="cpi" class="level2">
<h2 class="anchored" data-anchor-id="cpi">CPI</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Plot CPI’ #| warning: false #| output: true</p>
<p>#Plotting with ggplot2 cpi_plot &lt;- ggplot(cpi_data, aes(x = DATE, y = CPIAUCSL)) + geom_line(color = “#99494d”) +<br>
theme_minimal() + labs(title = “Consumer Price Index Over Time”,<br>
x = “Date”, y = “CPI”) + theme(plot.title = element_text(hjust = 0.5))</p>
<p>ggplotly(cpi_plot)</p>
<pre><code>





:::





# 3. Normalize &amp; Split the Data 

To improve the accuracy of our models, we will normalize the time series data and split it into training and testing sets. Normalizing helps align the data distributions and prepares the data for training. We'll use a common split ratio of 80% training and 20% testing.


::: panel-tabset

## Crude Oil




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true


#Normalize the crude oil data
oil_normalized &lt;- scale(composite_crude_oil_prices$Value)

#Split data into training and testing
split_index &lt;- floor(0.8 * length(oil_normalized))
oil_train &lt;- oil_normalized[1:split_index]
oil_test &lt;- oil_normalized[(split_index + 1):length(oil_normalized)]

# Print the shapes
cat("Shape of the Crude Oil Data:", length(oil_normalized), "\n")
cat("Shape of the Crude Oil Train Data:", length(oil_train), "\n")
cat("Shape of the Crude Oil Test Data:", length(oil_test), "\n")


#Plot the training and testing sets
train_dates &lt;- composite_crude_oil_prices$Date[1:split_index]
test_dates &lt;- composite_crude_oil_prices$Date[(split_index + 1):length(oil_normalized)]

oil_data &lt;- data.frame(
  Date = c(train_dates, test_dates),
  Value = c(oil_train, oil_test),
  Set = c(rep("Training", length(oil_train)), rep("Testing", length(oil_test)))
)

oil_plot1 &lt;- ggplot(oil_data, aes(x = Date, y = Value, fill = Set)) +
  geom_area(position = "stack") +
  theme_minimal() +
  labs(title = "Crude Oil Training and Testing Sets",
       x = "Date",
       y = "Normalized Crude Oil Prices") +
  theme(plot.title = element_text(hjust = 0.5))

ggplotly(oil_plot1)
</code></pre>
</section>
<section id="natural-gas" class="level2">
<h2 class="anchored" data-anchor-id="natural-gas">Natural Gas</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
</section>
</section>
<section id="normalize-the-natural-gas-data" class="level1">
<h1>Normalize the natural gas data</h1>
<p>gas_normalized &lt;- scale(citygate_gas_prices$Value)</p>
</section>
<section id="split-data-into-training-and-testing" class="level1">
<h1>Split data into training and testing</h1>
<p>split_index &lt;- floor(0.8 * length(gas_normalized)) gas_train &lt;- gas_normalized[1:split_index] gas_test &lt;- gas_normalized[(split_index + 1):length(gas_normalized)]</p>
</section>
<section id="print-the-shapes" class="level1">
<h1>Print the shapes</h1>
<p>cat(“Shape of the Natural Gas Data:”, length(gas_normalized), “”) cat(“Shape of the Natural Gas Train Data:”, length(gas_train), “”) cat(“Shape of the Natural Gas Test Data:”, length(gas_test), “”)</p>
</section>
<section id="plot-the-training-and-testing-sets" class="level1">
<h1>Plot the training and testing sets</h1>
<p>train_dates_gas &lt;- citygate_gas_prices<span class="math inline">\(Date[1:split_index]
test_dates_gas &lt;- citygate_gas_prices\)</span>Date[(split_index + 1):length(gas_normalized)]</p>
</section>
<section id="create-a-data-frame-for-plotting" class="level1">
<h1>Create a data frame for plotting</h1>
<p>gas_data &lt;- data.frame( Date = c(train_dates_gas, test_dates_gas), Value = c(gas_train, gas_test), Set = c(rep(“Training”, length(gas_train)), rep(“Testing”, length(gas_test))) )</p>
</section>
<section id="create-the-stacked-area-plot-using-ggplot2" class="level1">
<h1>Create the stacked area plot using ggplot2</h1>
<p>gas_plot &lt;- ggplot(gas_data, aes(x = Date, y = Value, fill = Set)) + geom_area(position = “stack”) + theme_minimal() + labs(title = “Natural Gas Training and Testing Sets”, x = “Date”, y = “Normalized Natural Gas Prices”) + theme(plot.title = element_text(hjust = 0.5))</p>
</section>
<section id="convert-the-plot-to-an-interactive-plotly-plot" class="level1">
<h1>Convert the plot to an interactive plotly plot</h1>
<p>ggplotly(gas_plot)</p>
<pre><code>





## Electricity




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true


#Normalize the electricity data
electricity_normalized &lt;- scale(total_electricity_prices$Value)

#Split data into training and testing
split_index &lt;- floor(0.8 * length(electricity_normalized))
electricity_train &lt;- electricity_normalized[1:split_index]
electricity_test &lt;- electricity_normalized[(split_index + 1):length(electricity_normalized)]

# Print the shapes
cat("Shape of the Electricity Prices Data:", length(electricity_normalized), "\n")
cat("Shape of the Electricity Prices Train Data:", length(electricity_train), "\n")
cat("Shape of the Electricity Prices Test Data:", length(electricity_test), "\n")


# Plot the training and testing sets
train_dates_elec &lt;- total_electricity_prices$Date[1:split_index]
test_dates_elec &lt;- total_electricity_prices$Date[(split_index + 1):length(electricity_normalized)]

# Create a data frame for plotting
elec_data &lt;- data.frame(
  Date = c(train_dates_elec, test_dates_elec),
  Value = c(electricity_train, electricity_test),
  Set = c(rep("Training", length(electricity_train)), rep("Testing", length(electricity_test)))
)

# Create the stacked area plot using ggplot2
elec_plot &lt;- ggplot(elec_data, aes(x = Date, y = Value, fill = Set)) +
  geom_area(position = "stack") +
  theme_minimal() +
  labs(title = "Electricity Training and Testing Sets",
       x = "Date",
       y = "Normalized Electricity Prices") +
  theme(plot.title = element_text(hjust = 0.5))

# Convert the plot to an interactive plotly plot
ggplotly(elec_plot)



</code></pre>
<section id="gdp" class="level2">
<h2 class="anchored" data-anchor-id="gdp">GDP</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
</section>
</section>
<section id="normalize-the-gdp-data" class="level1">
<h1>Normalize the GDP data</h1>
<p>gdp_normalized &lt;- scale(gdp_data$GDP)</p>
</section>
<section id="split-data-into-training-and-testing-1" class="level1">
<h1>Split data into training and testing</h1>
<p>split_index &lt;- floor(0.8 * length(gdp_normalized)) gdp_train &lt;- gdp_normalized[1:split_index] gdp_test &lt;- gdp_normalized[(split_index + 1):length(gdp_normalized)]</p>
</section>
<section id="print-the-shapes-1" class="level1">
<h1>Print the shapes</h1>
<p>cat(“Shape of the GDP Data:”, length(gdp_normalized), “”) cat(“Shape of the GDP Train Data:”, length(gdp_train), “”) cat(“Shape of the GDP Test Data:”, length(gdp_test), “”)</p>
</section>
<section id="plot-the-training-and-testing-sets-1" class="level1">
<h1>Plot the training and testing sets</h1>
<p>train_dates_gdp &lt;- gdp_data<span class="math inline">\(DATE[1:split_index]
test_dates_gdp &lt;- gdp_data\)</span>DATE[(split_index + 1):length(gdp_normalized)]</p>
</section>
<section id="create-a-data-frame-for-plotting-1" class="level1">
<h1>Create a data frame for plotting</h1>
<p>gdp_data_plot &lt;- data.frame( Date = c(train_dates_gdp, test_dates_gdp), Value = c(gdp_train, gdp_test), Set = c(rep(“Training”, length(gdp_train)), rep(“Testing”, length(gdp_test))) )</p>
</section>
<section id="create-the-stacked-area-plot-using-ggplot2-1" class="level1">
<h1>Create the stacked area plot using ggplot2</h1>
<p>gdp_plot1 &lt;- ggplot(gdp_data_plot, aes(x = Date, y = Value, fill = Set)) + geom_area(position = “stack”) + theme_minimal() + labs(title = “GDP Training and Testing Sets”, x = “Date”, y = “Normalized GDP”) + theme(plot.title = element_text(hjust = 0.5))</p>
</section>
<section id="convert-the-plot-to-an-interactive-plotly-plot-1" class="level1">
<h1>Convert the plot to an interactive plotly plot</h1>
<p>ggplotly(gdp_plot1)</p>
<pre><code>




## CPI




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true


# Normalize the CPI data
cpi_normalized &lt;- scale(cpi_data$CPIAUCSL)

# Split data into training and testing
split_index &lt;- floor(0.8 * length(cpi_normalized))
cpi_train &lt;- cpi_normalized[1:split_index]
cpi_test &lt;- cpi_normalized[(split_index + 1):length(cpi_normalized)]


# Print the shapes
cat("Shape of the CPI Data:", length(cpi_normalized), "\n")
cat("Shape of the CPI Train Data:", length(cpi_train), "\n")
cat("Shape of the CPI Test Data:", length(cpi_test), "\n")


# Plot the training and testing sets
train_dates_cpi &lt;- cpi_data$DATE[1:split_index]
test_dates_cpi &lt;- cpi_data$DATE[(split_index + 1):length(cpi_normalized)]

# Create a data frame for plotting
cpi_data_plot &lt;- data.frame(
  Date = c(train_dates_cpi, test_dates_cpi),
  Value = c(cpi_train, cpi_test),
  Set = c(rep("Training", length(cpi_train)), rep("Testing", length(cpi_test)))
)

# Create the stacked area plot using ggplot2
cpi_plot1 &lt;- ggplot(cpi_data_plot, aes(x = Date, y = Value, fill = Set)) +
  geom_area(position = "stack") +
  theme_minimal() +
  labs(title = "CPI Training and Testing Sets",
       x = "Date",
       y = "Normalized CPI") +
  theme(plot.title = element_text(hjust = 0.5))

# Convert the plot to an interactive plotly plot
ggplotly(cpi_plot1)


</code></pre>
</section>
<section id="mini-batching" class="level1">
<h1>4. Mini Batching</h1>
<p>Mini-batching is a technique used in deep learning to efficiently train models on large datasets. Instead of processing the entire dataset at once, mini-batching involves creating small, sequential subsets of the data called “mini-batches.” This approach offers several benefits, including memory efficiency, faster convergence, and the ability to use stochastic gradient descent (SGD) optimization. By processing a portion of the data at a time, mini-batching reduces the memory requirements compared to processing the entire dataset simultaneously, making it feasible to train models on large datasets.</p>
<p>To implement mini-batching, the dataset is typically shuffled and divided into smaller batches of a fixed size. The model is then trained iteratively, processing one mini-batch at a time. The gradients are computed for each mini-batch, and the model’s parameters are updated accordingly. This process is repeated until the model has seen the entire dataset, which constitutes one epoch of training. The choice of mini-batch size is an important hyperparameter that determines the number of samples processed in each iteration, and it can impact the convergence speed and stability of the training process.</p>
<p>::: panel-tabset</p>
<section id="crude-oil-1" class="level2">
<h2 class="anchored" data-anchor-id="crude-oil-1">Crude Oil</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
</section>
</section>
<section id="function-to-create-mini-batches" class="level1">
<h1>Function to create mini-batches</h1>
<p>form_arrays &lt;- function(x, lookback = 3, delay = 1, step = 1, feature_columns = 1, target_columns = 1, unique = FALSE, verbose = FALSE) { count &lt;- 0 x_out &lt;- list() y_out &lt;- list() i_start &lt;- 1</p>
<p>while (i_start + lookback + delay &lt;= nrow(x)) { i_stop &lt;- i_start + lookback - 1 i_pred &lt;- i_stop + delay indices_to_keep &lt;- seq(i_stop, i_start, -step) xtmp &lt;- x[indices_to_keep, feature_columns, drop = FALSE] ytmp &lt;- x[i_pred, target_columns, drop = FALSE] x_out &lt;- append(x_out, list(xtmp)) y_out &lt;- append(y_out, list(ytmp))</p>
<pre><code>if (verbose &amp;&amp; count &lt; 2) {
  plot(seq_len(nrow(x)), x[, feature_columns], type = "b", col = "blue", xlab = "Index", ylab = "Value")
  points(indices_to_keep, xtmp, col = "green", pch = 19)
  points(i_pred, ytmp, col = "red", pch = 19)
}

#Update start point
if (unique) {
  i_start &lt;- i_start + lookback
} else {
  i_start &lt;- i_start + 1
}
count &lt;- count + 1</code></pre>
<p>}</p>
<p>return(list(x = array(unlist(x_out), dim = c(length(x_out), lookback, length(feature_columns))), y = array(unlist(y_out), dim = c(length(y_out), length(target_columns))))) }</p>
<p>lookback &lt;- 5</p>
<p>oil_train &lt;- as.matrix(oil_train) oil_test &lt;- as.matrix(oil_test) oil_train_batches &lt;- form_arrays(oil_train, lookback = lookback, delay = 1, step = 1, feature_columns = 1, target_columns = 1) oil_test_batches &lt;- form_arrays(oil_test, lookback = lookback, delay = 1, step = 1, feature_columns = 1, target_columns = 1)</p>
<p>train_shape &lt;- dim(oil_train_batches<span class="math inline">\(x)
test_shape &lt;- dim(oil_test_batches\)</span>x)</p>
<p>cat(sprintf(“Train shape: (%d, %d, %d) , (%d, %d)”, train_shape[1], train_shape[2], train_shape[3], dim(oil_train_batches<span class="math inline">\(y)[1], dim(oil_train_batches\)</span>y)[2])) cat(sprintf(“Test shape: (%d, %d, %d) , (%d, %d)”, test_shape[1], test_shape[2], test_shape[3], dim(oil_test_batches<span class="math inline">\(y)[1], dim(oil_test_batches\)</span>y)[2]))</p>
<pre><code>
```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true

np &lt;- import("numpy")

# Save the mini-batches to .npy files
np$save("oil_train_batches_x.npy", oil_train_batches$x)
np$save("oil_train_batches_y.npy", oil_train_batches$y)
np$save("oil_test_batches_x.npy", oil_test_batches$x)
np$save("oil_test_batches_y.npy", oil_test_batches$y)</code></pre>
<section id="natural-gas-1" class="level2">
<h2 class="anchored" data-anchor-id="natural-gas-1">Natural Gas</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<p>gas_train &lt;- as.matrix(gas_train) gas_test &lt;- as.matrix(gas_test) gas_train_batches &lt;- form_arrays(gas_train, lookback = lookback, delay = 1, step = 1, feature_columns = 1, target_columns = 1) gas_test_batches &lt;- form_arrays(gas_test, lookback = lookback, delay = 1, step = 1, feature_columns = 1, target_columns = 1)</p>
</section>
</section>
<section id="display-the-shape" class="level1">
<h1>Display the shape</h1>
<p>train_shape_gas &lt;- dim(gas_train_batches<span class="math inline">\(x)
test_shape_gas &lt;- dim(gas_test_batches\)</span>x)</p>
<p>cat(sprintf(“Natural Gas Train shape: (%d, %d, %d) , (%d, %d)”, train_shape_gas[1], train_shape_gas[2], train_shape_gas[3], dim(gas_train_batches<span class="math inline">\(y)[1], dim(gas_train_batches\)</span>y)[2])) cat(sprintf(“Natural Gas Test shape: (%d, %d, %d) , (%d, %d)”, test_shape_gas[1], test_shape_gas[2], test_shape_gas[3], dim(gas_test_batches<span class="math inline">\(y)[1], dim(gas_test_batches\)</span>y)[2]))</p>
<pre><code>





## Electricity




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true


electricity_train &lt;- as.matrix(electricity_train)
electricity_test &lt;- as.matrix(electricity_test)
electricity_train_batches &lt;- form_arrays(electricity_train, lookback  = lookback, delay = 1, step = 1, feature_columns = 1, target_columns = 1)
electricity_test_batches &lt;- form_arrays(electricity_test, lookback  = lookback, delay = 1, step = 1, feature_columns = 1, target_columns = 1)

# Display the shape
train_shape_elec &lt;- dim(electricity_train_batches$x)
test_shape_elec &lt;- dim(electricity_test_batches$x)

cat(sprintf("Electricity Train shape: (%d, %d, %d) , (%d, %d)\n",
            train_shape_elec[1], train_shape_elec[2], train_shape_elec[3], dim(electricity_train_batches$y)[1], dim(electricity_train_batches$y)[2]))
cat(sprintf("Electricity Test shape: (%d, %d, %d) , (%d, %d)\n",
            test_shape_elec[1], test_shape_elec[2], test_shape_elec[3], dim(electricity_test_batches$y)[1], dim(electricity_test_batches$y)[2]))
</code></pre>
<section id="gdp-1" class="level2">
<h2 class="anchored" data-anchor-id="gdp-1">GDP</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<p>gdp_train &lt;- as.matrix(gdp_train) gdp_test &lt;- as.matrix(gdp_test) gdp_train_batches &lt;- form_arrays(gdp_train, lookback = lookback, delay = 1, step = 1, feature_columns = 1, target_columns = 1) gdp_test_batches &lt;- form_arrays(gdp_test, lookback = lookback, delay = 1, step = 1, feature_columns = 1, target_columns = 1)</p>
</section>
</section>
<section id="display-the-shape-1" class="level1">
<h1>Display the shape</h1>
<p>train_shape_gdp &lt;- dim(gdp_train_batches<span class="math inline">\(x)
test_shape_gdp &lt;- dim(gdp_test_batches\)</span>x)</p>
<p>cat(sprintf(“GDP Train shape: (%d, %d, %d) , (%d, %d)”, train_shape_gdp[1], train_shape_gdp[2], train_shape_gdp[3], dim(gdp_train_batches<span class="math inline">\(y)[1], dim(gdp_train_batches\)</span>y)[2])) cat(sprintf(“GDP Test shape: (%d, %d, %d) , (%d, %d)”, test_shape_gdp[1], test_shape_gdp[2], test_shape_gdp[3], dim(gdp_test_batches<span class="math inline">\(y)[1], dim(gdp_test_batches\)</span>y)[2]))</p>
<pre><code>




## CPI




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true


cpi_train &lt;- as.matrix(cpi_train)
cpi_test &lt;- as.matrix(cpi_test)
cpi_train_batches &lt;- form_arrays(cpi_train, lookback  = lookback, delay = 1, step = 1, feature_columns = 1, target_columns = 1)
cpi_test_batches &lt;- form_arrays(cpi_test, lookback  = lookback, delay = 1, step = 1, feature_columns = 1, target_columns = 1)

# Display the shape
train_shape_cpi &lt;- dim(cpi_train_batches$x)
test_shape_cpi &lt;- dim(cpi_test_batches$x)

cat(sprintf("CPI Train shape: (%d, %d, %d) , (%d, %d)\n",
            train_shape_cpi[1], train_shape_cpi[2], train_shape_cpi[3], dim(cpi_train_batches$y)[1], dim(cpi_train_batches$y)[2]))
cat(sprintf("CPI Test shape: (%d, %d, %d) , (%d, %d)\n",
            test_shape_cpi[1], test_shape_cpi[2], test_shape_cpi[3], dim(cpi_test_batches$y)[1], dim(cpi_test_batches$y)[2]))
</code></pre>
</section>
<section id="recurrent-neural-networks-rnns" class="level1">
<h1>5. Recurrent Neural Networks (RNNs)</h1>
<p>Recurrent Neural Networks (RNNs) are designed to process sequential data, making them ideal for time series forecasting. Unlike traditional neural networks, RNNs have a memory component that allows them to consider previous time steps, making them particularly adept at handling temporal dependencies. In this section, we will implement an RNN to forecast future trends in our data.</p>
<p>::: panel-tabset</p>
<section id="crude-oil-2" class="level2">
<h2 class="anchored" data-anchor-id="crude-oil-2">Crude Oil</h2>
<div id="019661e3" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the mini-batches from .npy files</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>trainX <span class="op">=</span> np.load(<span class="st">"oil_train_batches_x.npy"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>trainY <span class="op">=</span> np.load(<span class="st">"oil_train_batches_y.npy"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>testX <span class="op">=</span> np.load(<span class="st">"oil_test_batches_x.npy"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>testY <span class="op">=</span> np.load(<span class="st">"oil_test_batches_y.npy"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>Xt1_oil <span class="op">=</span> trainX.reshape(trainX.shape[<span class="dv">0</span>], trainX.shape[<span class="dv">1</span>] <span class="op">*</span> trainX.shape[<span class="dv">2</span>])</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> <span class="st">"rmsprop"</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>loss_function <span class="op">=</span> <span class="st">"MeanSquaredError"</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>learning_rate <span class="op">=</span> <span class="fl">0.001</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>number_of_epochs <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>L2 <span class="op">=</span> <span class="fl">0.01</span>  <span class="co"># Regularization strength</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>input_shape <span class="op">=</span> (trainX.shape[<span class="dv">1</span>], trainX.shape[<span class="dv">2</span>])</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co">#batch_size=1                       # stocastic training</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co">#batch_size=int(len(Xt1_oil)/2.)    # mini-batch training</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_oil)              <span class="co"># batch training</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>model_no_reg <span class="op">=</span> keras.Sequential()</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(GRU(</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>model_no_reg.add(SimpleRNN(</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape, </span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="co">#recurrent_regularizer=regularizers.L2(L2),</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>          ) </span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="co">#CREATE MODEL WITH REGULARIZATION</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>model_reg <span class="op">=</span> keras.Sequential()</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>model_reg.add(SimpleRNN(</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR </span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>model_no_reg.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>model_reg.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span></code></pre></div>
</details>
</div>
<div id="45eefa7c" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Model without regularization:"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_no_reg.summary())</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Model with regularization:"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_reg.summary())</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model without regularization:
Model: "sequential"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 simple_rnn (SimpleRNN)      (None, 30)                960       
                                                                 
 dense (Dense)               (None, 1)                 31        
                                                                 
=================================================================
Total params: 991 (3.87 KB)
Trainable params: 991 (3.87 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None
Model with regularization:
Model: "sequential_1"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 simple_rnn_1 (SimpleRNN)    (None, 30)                960       
                                                                 
 dense_1 (Dense)             (None, 1)                 31        
                                                                 
=================================================================
Total params: 991 (3.87 KB)
Trainable params: 991 (3.87 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
</div>
<div id="9afb4bd7" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # print("initial parameters:", model.get_weights())</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># COMPILING THE MODELS</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>model_no_reg.<span class="bu">compile</span>(optimizer<span class="op">=</span>RMSprop(learning_rate<span class="op">=</span>learning_rate), loss<span class="op">=</span>loss_function)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>model_reg.<span class="bu">compile</span>(optimizer<span class="op">=</span>RMSprop(learning_rate<span class="op">=</span>learning_rate), loss<span class="op">=</span>loss_function)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>early_stopping <span class="op">=</span> EarlyStopping(monitor<span class="op">=</span><span class="st">'val_loss'</span>, patience<span class="op">=</span><span class="dv">10</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING THE MODELS</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>history_oil_no_reg <span class="op">=</span> model_no_reg.fit(trainX,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>                                      trainY,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>                                      epochs<span class="op">=</span>number_of_epochs,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>                                      batch_size<span class="op">=</span>batch_size,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>                                      verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>                                      validation_data<span class="op">=</span>(testX, testY),</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>                                      callbacks<span class="op">=</span>[early_stopping])</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>history_oil_reg <span class="op">=</span> model_reg.fit(trainX,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>                                trainY,</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>                                epochs<span class="op">=</span>number_of_epochs,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>                                batch_size<span class="op">=</span>batch_size,</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>                                verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>                                validation_data<span class="op">=</span>(testX, testY),</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>                                callbacks<span class="op">=</span>[early_stopping])</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> history_plot(history_no_reg, history_reg):</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    FS <span class="op">=</span> <span class="dv">18</span>  <span class="co"># fontsize</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the history dictionaries</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    history_dict_no_reg <span class="op">=</span> history_no_reg.history</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    history_dict_reg <span class="op">=</span> history_reg.history</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the loss values and epochs for both models</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    loss_values_no_reg <span class="op">=</span> history_dict_no_reg[<span class="st">'loss'</span>]</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    val_loss_values_no_reg <span class="op">=</span> history_dict_no_reg[<span class="st">'val_loss'</span>]</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    loss_values_reg <span class="op">=</span> history_dict_reg[<span class="st">'loss'</span>]</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>    val_loss_values_reg <span class="op">=</span> history_dict_reg[<span class="st">'val_loss'</span>]</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>    epochs <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(loss_values_no_reg) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a new figure</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the training and validation loss for the non-regularized model</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>    plt.plot(epochs, loss_values_no_reg, <span class="st">'bo'</span>, label<span class="op">=</span><span class="st">'Training Loss (No Reg)'</span>)</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>    plt.plot(epochs, val_loss_values_no_reg, <span class="st">'b'</span>, label<span class="op">=</span><span class="st">'Validation Loss (No Reg)'</span>)</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the training and validation loss for the regularized model</span></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>    plt.plot(epochs, loss_values_reg, <span class="st">'ro'</span>, label<span class="op">=</span><span class="st">'Training Loss (Reg)'</span>)</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>    plt.plot(epochs, val_loss_values_reg, <span class="st">'r'</span>, label<span class="op">=</span><span class="st">'Validation Loss (Reg)'</span>)</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add labels and legend</span></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Training and Validation Loss'</span>)</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Epochs'</span>)</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Loss'</span>)</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show the plot</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>history_plot(history_oil_no_reg, history_oil_reg)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>WARNING:absl:At this time, the v2.11+ optimizer `tf.keras.optimizers.RMSprop` runs slowly on M1/M2 Macs, please use the legacy Keras optimizer instead, located at `tf.keras.optimizers.legacy.RMSprop`.
WARNING:absl:There is a known slowdown when using v2.11+ Keras optimizers on M1/M2 Macs. Falling back to the legacy Keras optimizer, i.e., `tf.keras.optimizers.legacy.RMSprop`.
WARNING:absl:At this time, the v2.11+ optimizer `tf.keras.optimizers.RMSprop` runs slowly on M1/M2 Macs, please use the legacy Keras optimizer instead, located at `tf.keras.optimizers.legacy.RMSprop`.
WARNING:absl:There is a known slowdown when using v2.11+ Keras optimizers on M1/M2 Macs. Falling back to the legacy Keras optimizer, i.e., `tf.keras.optimizers.legacy.RMSprop`.</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-ts_files/figure-html/cell-5-output-2.png" width="961" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="8acfa499" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PREDICTIONS</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>Ytp_oil_no_reg <span class="op">=</span> model_no_reg.predict(trainX)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>Yvp_oil_no_reg <span class="op">=</span> model_no_reg.predict(testX)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>Ytp_oil_reg <span class="op">=</span> model_reg.predict(trainX)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>Yvp_oil_reg <span class="op">=</span> model_reg.predict(testX)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> 1/10 [==&gt;...........................] - ETA: 0s10/10 [==============================] - 0s 515us/step
1/3 [=========&gt;....................] - ETA: 0s3/3 [==============================] - 0s 736us/step
 1/10 [==&gt;...........................] - ETA: 0s10/10 [==============================] - 0s 426us/step
1/3 [=========&gt;....................] - ETA: 0s3/3 [==============================] - 0s 564us/step</code></pre>
</div>
</div>
<div id="3064a35a" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> regression_report(yt, ytp, yv, yvp, model_name):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"--------- Regression Report (</span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">) ---------"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"TRAINING:"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    train_mse <span class="op">=</span> np.mean((yt <span class="op">-</span> ytp) <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    train_mae <span class="op">=</span> np.mean(np.<span class="bu">abs</span>(yt <span class="op">-</span> ytp))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"MSE"</span>, train_mse)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"MAE"</span>, train_mae)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PARITY PLOT</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    ax.plot(yt, ytp, <span class="st">'ro'</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    ax.plot(yt, yt, <span class="st">'b-'</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'Actual Crude Oil Prices'</span>, ylabel<span class="op">=</span><span class="st">'Predicted Crude Oil Prices'</span>,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>           title<span class="op">=</span><span class="ss">f'Training Data Parity Plot (</span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PLOT PART OF THE PREDICTED TIME-SERIES</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    frac_plot <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    upper <span class="op">=</span> <span class="bu">int</span>(frac_plot <span class="op">*</span> yt.shape[<span class="dv">0</span>])</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    ax.plot(yt[<span class="dv">0</span>:upper], <span class="st">'b-'</span>)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    ax.plot(ytp[<span class="dv">0</span>:upper], <span class="st">'r-'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    ax.plot(ytp[<span class="dv">0</span>:upper], <span class="st">'ro'</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'Time'</span>, ylabel<span class="op">=</span><span class="st">'Crude Oil Prices (Blue=Actual &amp; Red=Prediction)'</span>,</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>           title<span class="op">=</span><span class="ss">f'Training: Time-Series Prediction (</span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"VALIDATION:"</span>)</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>    val_mse <span class="op">=</span> np.mean((yv <span class="op">-</span> yvp) <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>    val_mae <span class="op">=</span> np.mean(np.<span class="bu">abs</span>(yv <span class="op">-</span> yvp))</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"MSE"</span>, val_mse)</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"MAE"</span>, val_mae)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PARITY PLOT</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>    ax.plot(yv, yvp, <span class="st">'ro'</span>)</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>    ax.plot(yv, yv, <span class="st">'b-'</span>)</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'Actual Crude Oil Prices'</span>, ylabel<span class="op">=</span><span class="st">'Predicted Crude Oil Prices'</span>,</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>           title<span class="op">=</span><span class="ss">f'Validation Data Parity Plot (</span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PLOT PART OF THE PREDICTED TIME-SERIES</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>    upper <span class="op">=</span> <span class="bu">int</span>(frac_plot <span class="op">*</span> yv.shape[<span class="dv">0</span>])</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>    ax.plot(yv[<span class="dv">0</span>:upper], <span class="st">'b-'</span>)</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>    ax.plot(yvp[<span class="dv">0</span>:upper], <span class="st">'r-'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>    ax.plot(yvp[<span class="dv">0</span>:upper], <span class="st">'ro'</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'Time'</span>, ylabel<span class="op">=</span><span class="st">'Crude Oil Prices (Blue=Actual &amp; Red=Prediction)'</span>,</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>           title<span class="op">=</span><span class="ss">f'Validation: Time-Series Prediction (</span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> train_mse, train_mae, val_mse, val_mae</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression report for the non-regularized model</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>train_mse_no_reg, train_mae_no_reg, val_mse_no_reg, val_mae_no_reg <span class="op">=</span> regression_report(trainY, Ytp_oil_no_reg, testY, Yvp_oil_no_reg, <span class="st">"Non-Regularized Model"</span>)</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression report for the regularized model</span></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>train_mse_reg, train_mae_reg, val_mse_reg, val_mae_reg <span class="op">=</span> regression_report(trainY, Ytp_oil_reg, testY, Yvp_oil_reg, <span class="st">"Regularized Model"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>--------- Regression Report (Non-Regularized Model) ---------
TRAINING:
MSE 1.3641526161138178
MAE 1.0740010830862619
VALIDATION:
MSE 0.3926946168942365
MAE 0.47367857545491193
--------- Regression Report (Regularized Model) ---------
TRAINING:
MSE 1.2809680164599633
MAE 0.9898398005377544
VALIDATION:
MSE 0.5934448110565091
MAE 0.601928361317063</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-ts_files/figure-html/cell-7-output-2.png" width="600" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-ts_files/figure-html/cell-7-output-3.png" width="600" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-ts_files/figure-html/cell-7-output-4.png" width="600" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-ts_files/figure-html/cell-7-output-5.png" width="600" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-ts_files/figure-html/cell-7-output-6.png" width="600" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-ts_files/figure-html/cell-7-output-7.png" width="600" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-ts_files/figure-html/cell-7-output-8.png" width="600" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="deep-learning-ts_files/figure-html/cell-7-output-9.png" width="600" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="natural-gas-2" class="level2">
<h2 class="anchored" data-anchor-id="natural-gas-2">Natural Gas</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>





## Electricity




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
<section id="gdp-2" class="level2">
<h2 class="anchored" data-anchor-id="gdp-2">GDP</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>




## CPI




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
</section>
<section id="lstm" class="level1">
<h1>6. LSTM</h1>
<p>Now, we will move forward to fit an ARCH/GARCH model to the stock price data. The first step in this process is to prepare the time series by calculating the stock price returns, which are typically used in financial time series modeling because they are more likely to exhibit stationary properties—a key requirement for ARCH/GARCH models.</p>
<p>::: panel-tabset</p>
<section id="crude-oil-3" class="level2">
<h2 class="anchored" data-anchor-id="crude-oil-3">Crude Oil</h2>
</section>
<section id="natural-gas-3" class="level2">
<h2 class="anchored" data-anchor-id="natural-gas-3">Natural Gas</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>





## Electricity




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
<section id="gdp-3" class="level2">
<h2 class="anchored" data-anchor-id="gdp-3">GDP</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>




## CPI




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
</section>
<section id="gru" class="level1">
<h1>7. GRU</h1>
<p>Now, we will move forward to fit an ARCH/GARCH model to the stock price data. The first step in this process is to prepare the time series by calculating the stock price returns, which are typically used in financial time series modeling because they are more likely to exhibit stationary properties—a key requirement for ARCH/GARCH models.</p>
<p>::: panel-tabset</p>
<section id="crude-oil-4" class="level2">
<h2 class="anchored" data-anchor-id="crude-oil-4">Crude Oil</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>





## Natural Gas



```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
<section id="electricity-1" class="level2">
<h2 class="anchored" data-anchor-id="electricity-1">Electricity</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>




## GDP




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
<section id="cpi-1" class="level2">
<h2 class="anchored" data-anchor-id="cpi-1">CPI</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>








# 8. Discussion

Now, we will move forward to fit an ARCH/GARCH model to the stock price data. The first step in this process is to prepare the time series by calculating the stock price returns, which are typically used in financial time series modeling because they are more likely to exhibit stationary properties—a key requirement for ARCH/GARCH models.


::: panel-tabset

## Crude Oil




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
<section id="natural-gas-4" class="level2">
<h2 class="anchored" data-anchor-id="natural-gas-4">Natural Gas</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>





## Electricity




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
<section id="gdp-4" class="level2">
<h2 class="anchored" data-anchor-id="gdp-4">GDP</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>




## CPI




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
<section id="how-do-the-results-from-the-3-different-ann-models-compare-with-each-other-in-terms-of-accuracy-and-predictive-power" class="level2">
<h2 class="anchored" data-anchor-id="how-do-the-results-from-the-3-different-ann-models-compare-with-each-other-in-terms-of-accuracy-and-predictive-power">8.1 How do the results from the 3 different ANN models compare with each other in terms of accuracy and predictive power?</h2>
<p>Now, we will move forward to fit an ARCH/GARCH model to the stock price data. The first step in this process is to prepare the time series by calculating the stock price returns, which are typically used in financial time series modeling because they are more likely to exhibit stationary properties—a key requirement for ARCH/GARCH models.</p>
<p>::: panel-tabset</p>
</section>
<section id="crude-oil-5" class="level2">
<h2 class="anchored" data-anchor-id="crude-oil-5">Crude Oil</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>





## Natural Gas



```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
<section id="electricity-2" class="level2">
<h2 class="anchored" data-anchor-id="electricity-2">Electricity</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>




## GDP




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
<section id="cpi-2" class="level2">
<h2 class="anchored" data-anchor-id="cpi-2">CPI</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>







## 8.2 What effect does including regularization have on your results?

Now, we will move forward to fit an ARCH/GARCH model to the stock price data. The first step in this process is to prepare the time series by calculating the stock price returns, which are typically used in financial time series modeling because they are more likely to exhibit stationary properties—a key requirement for ARCH/GARCH models.


::: panel-tabset

## Crude Oil




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
<section id="natural-gas-5" class="level2">
<h2 class="anchored" data-anchor-id="natural-gas-5">Natural Gas</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>





## Electricity




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
<section id="gdp-5" class="level2">
<h2 class="anchored" data-anchor-id="gdp-5">GDP</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>




## CPI




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
<section id="how-far-into-the-future-can-the-deep-learning-model-accurately-predict-the-future" class="level2">
<h2 class="anchored" data-anchor-id="how-far-into-the-future-can-the-deep-learning-model-accurately-predict-the-future">8.3 How far into the future can the deep learning model accurately predict the future?</h2>
<p>Now, we will move forward to fit an ARCH/GARCH model to the stock price data. The first step in this process is to prepare the time series by calculating the stock price returns, which are typically used in financial time series modeling because they are more likely to exhibit stationary properties—a key requirement for ARCH/GARCH models.</p>
<p>::: panel-tabset</p>
</section>
<section id="crude-oil-6" class="level2">
<h2 class="anchored" data-anchor-id="crude-oil-6">Crude Oil</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>





## Natural Gas



```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
<section id="electricity-3" class="level2">
<h2 class="anchored" data-anchor-id="electricity-3">Electricity</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>




## GDP




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
<section id="cpi-3" class="level2">
<h2 class="anchored" data-anchor-id="cpi-3">CPI</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>









## 8.4. How does your deep learning modeling compare to the traditional single-variable time-series ARMA/ARIMA models from HW-3?

Now, we will move forward to fit an ARCH/GARCH model to the stock price data. The first step in this process is to prepare the time series by calculating the stock price returns, which are typically used in financial time series modeling because they are more likely to exhibit stationary properties—a key requirement for ARCH/GARCH models.


::: panel-tabset

## Crude Oil




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
<section id="natural-gas-6" class="level2">
<h2 class="anchored" data-anchor-id="natural-gas-6">Natural Gas</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>





## Electricity




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
<section id="gdp-6" class="level2">
<h2 class="anchored" data-anchor-id="gdp-6">GDP</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>




## CPI




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
</section>
<section id="write-a-discussion-paragraph-comparing-your-models-use-rmse-and-forecasts-from-these-sections-with-your-deep-learning-models." class="level1">
<h1>9. Write a discussion paragraph Comparing your models (use RMSE) and forecasts from these sections with your Deep Learning Models.</h1>
<p>Now, we will move forward to fit an ARCH/GARCH model to the stock price data. The first step in this process is to prepare the time series by calculating the stock price returns, which are typically used in financial time series modeling because they are more likely to exhibit stationary properties—a key requirement for ARCH/GARCH models.</p>
<p>::: panel-tabset</p>
<section id="crude-oil-7" class="level2">
<h2 class="anchored" data-anchor-id="crude-oil-7">Crude Oil</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>





## Natural Gas



```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
<section id="electricity-4" class="level2">
<h2 class="anchored" data-anchor-id="electricity-4">Electricity</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<pre><code>




## GDP




```{r, warning=FALSE, message=FALSE, echo=TRUE}
#| code-fold: true
#| code-summary: 'Code'
#| warning: false
#| output: true
</code></pre>
</section>
<section id="cpi-4" class="level2">
<h2 class="anchored" data-anchor-id="cpi-4">CPI</h2>
<p>```{r, warning=FALSE, message=FALSE, echo=TRUE} #| code-fold: true #| code-summary: ‘Code’ #| warning: false #| output: true</p>
<p>```</p>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>